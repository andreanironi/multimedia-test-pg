"use strict";function efsaPesticideDataviz(t){function e(t,e){d3.request(t).mimeType("text/plain").response(function(t){return d3.dsvFormat(";").parse(t.responseText)}).get(function(t){e(t)})}function a(){G=q.round(j/V),Q=null,d3.select("#efsa-pesticide-loading").style("display","block").style("background-color","rgba(245,245,245,.5)"),function(t){e("data/food.csv",t)}(function(t){var e=[],a=[],r=[],n={},c=0;_.each(t,function(t){var i=t.Category,s=t.SubCategory,o=+t.Samples;e.push({name:i,subcategory:null}),a[i]=a[i]?a[i]:[],a[i].indexOf(s)<0&&a[i].push(s),n["cat-"+i]=n["cat-"+i]?n["cat-"+i]:0,n["subcat-"+s]=n["subcat-"+s]?n["subcat-"+s]:0,n["cat-"+i]+=o,n["subcat-"+s]+=o,r.push({name:t.Food,subcategory:s,category:i,value:o,value_below_loq_as_samples:t["Below LOQ"],value_below_mrl_as_samples:t["Below MRL"],value_above_mrl_as_samples:t["Above MRL"],value_below_loq:t["% Below LOQ"],value_below_mrl:t["% Below MRL"],value_above_mrl:t["% Above MRL"]}),s.length>c&&(c=s.length)}),c=Math.min(45,c),$=c*At/1.53,$=Math.max(J+30,$),i(e=_.uniq(_.map(e,function(t){return t.name})),a,r,n,"food")})}function r(){Q=null,G=q.round(j/V),G*=1.3,d3.select("#efsa-pesticide-loading").style("display","block").style("background-color","rgba(245,245,245,.5)"),function(t){e("data/results-by-country.csv",function(a){for(var r in a){var i=a[r];i.name&&(Bt[i.name]={value_below_loq:+i["%below LOQ"],value_below_mrl:+i["%betweenLOQ_MRL"],value_above_mrl:+i["%aboveLOQ"]})}e("data/results-by-origin.csv",function(a){for(var r in a){var i=a[r];i.name&&(Ot[i.name]={value_below_loq:+i["%belowLOQ"],value_below_mrl:+i["%betweenLOQ_MRL"],value_above_mrl:+i["%aboveLOQ"]})}e("data/origin-of-sample.csv",function(a){for(var r in a){var i=a[r];i.name&&(Dt[i.name]={dom:+i.dom,eu:+i.eu,tc:+i.tc,un:+i.un})}e("data/country.csv",t)})})})}(function(t){var e=[],a=[],r=[],n={},c=[],s={};_.each(t,function(t){var e=t.country;c[e]||(c[e]={name:e,countrycode:t.code,inhabitants:t.inhabitants,samples:0}),c[e].samples+=+t.samples,s[t.country]=s[t.country]?s[t.country]:[],s[t.country].push({country:t.refcountry,type:t.type,samples:+t.samples})}),e=["countries"],a.countries=[];var o=0;for(var l in c){var d=c[l],p=d.name,f=+d.samples;a.countries.push(p),r.push({name:p,countrycode:d.countrycode,subcategory:p,category:"countries",value:f,value_below_loq:Bt[p].value_below_loq,value_below_mrl:Bt[p].value_below_mrl,value_above_mrl:Bt[p].value_above_mrl,samples:f,inhabitants:+d.inhabitants}),p.length>o&&(o=p.length),n["cat-countries"]=n["cat-countries"]?n["cat-countries"]:0,n["subcat-"+p]=n["subcat-"+p]?n["subcat-"+p]:0,n["cat-countries"]+=f,n["subcat-"+p]+=f,n["subcat-"+p+"-inhabitants"]=+d.inhabitants}$=o*At/2+30,$=Math.max(J+30,$),n.composition=s,i(e,a,r,n,"country")})}function i(e,a,r,i,s){function o(t){q.d3stopPropagation(),et||ct||(mobile&&d3.selectAll(".efsa-pesticide-subtab").transition().duration(l/5).attr("fill",function(t,e){return e===pt?d3.select(this).attr("fill-default"):d3.select(this).attr("fill-brighter")}),ut=!1,T.attr("opacity","1"),W<2&&!mobile?(v.style("cursor",function(e){return e.category===t?"pointer":"default"}).transition().duration(l).attr("opacity",function(e){return e.category===t?1:mt}),setTimeout(function(){ut=!0},l)):(v.attr("opacity",function(e){return e.category===t?1:mt}).style("cursor",function(e){return e.category===t?"pointer":"default"}),ut=!0))}function R(t){pt!==t&&d3.select(this).transition().duration(l/5).attr("fill",d3.select(this).attr("fill-brighter"))}function V(t){q.d3stopPropagation(),et||(this&&this!==window&&(mobile&&d3.selectAll(".efsa-pesticide-subtab").transition().duration(l/5).attr("fill",function(t,e){return e===pt?d3.select(this).attr("fill-default"):d3.select(this).attr("fill-brighter")}),d3.select(this).transition().duration(l/5).attr("fill",d3.select(this).attr("fill-default"))),ct||(ut=!1,T.attr("opacity","1"),W<2&&!mobile?(v.style("cursor",function(e){return e.subcategory===t?"pointer":"default"}).transition().duration(l/3).attr("opacity",function(e){return e.subcategory===t?1:mt}),setTimeout(function(){ut=!0},l)):(v.attr("opacity",function(e){return e.subcategory===t?1:mt}).style("cursor",function(e){return e.subcategory===t?"pointer":"default"}),ut=!0)))}function Dt(){v.attr("opacity","1"),T.attr("opacity","1")}function Mt(t){t.style("display","block")}function Et(t){t.style("display","none")}function Ut(t,e,a){if(q.d3stopPropagation(),X=null,qe&&0!==qe.length&&-1!==it){nt=!0,it=-1;var r=v;r.attr("stroke-width",0).attr("fill",function(t,e){return d3.select(this).attr("fill-val")}),"country"===s&&r.attr("stroke-width",gt).attr("stroke",bt);var i=0;r.transition().duration(.7*l).ease(q.qeaseElastic).attr("cx",function(t,e){return i++,qe[e].x}).attr("cy",function(t,e){return qe[e].y}).attr("r",function(t,e){return d3.select(this).attr("r-val")}).on("end",function(){if(!--i){for(var t=0;t<Ae;t++){var e=qe[t];ke[t].radius=e.radius,ke[t].fx=e.x,ke[t].fy=e.y,ke[t].x=ke[t].fx,ke[t].y=ke[t].fy}nt=!1}}),X=null,Zt(),a&&Qt(!1)}}function Ft(t,e){if(q.d3stopPropagation(),qe&&0!==qe.length&&ut&&!et&&!at&&(ct&&ie(),null===tt||tt===t.cluster)){"1"===d3.select("#efsa-pesticide-food-"+e).attr("opacity")&&(X=t.index,nt?setTimeout(function(){Rt(t,e)},.7*l):Rt(t,e))}}function Rt(t,e){if(t.index===X){"food"!==s&&(Et(E),Et(M),Et(U)),it=t.index;for(var a=0;a<Ae;a++)a!==e?(ke[a].fx=null,ke[a].fy=null):(ke[a].fx=qe[e].x,ke[a].fy=qe[e].y);ke[e].radius=yt,Ce.nodes(ke).alphaTarget(mobile?.003:.002).alphaDecay(.8).restart();var r=d3.select("#efsa-pesticide-food-"+e),i=t.color;r.attr("stroke-width",yt/10).attr("stroke",i).attr("fill","white"),r.transition().ease(q.qeaseElastic).duration(l).attr("r",yt-yt/10),xe(!1),Wt();var n=t.food,c=t.samples;q.d3attr(g,{subcategory:t.subcategory,category:t.category,value_below_loq:t.value_below_loq,value_below_mrl:t.value_below_mrl,value_above_mrl:t.value_above_mrl,samples:c,name:n});var o={x:+qe[e].x,y:+qe[e].y};!function(t,e,a,r){Mt(g),q.d3attr(g,{stroke:a,"stroke-width":0,fill:"white",cx:t,cy:e,r:r});var i=at?-H/5:0;q.d3attr(g,{transform:"translate("+i+",0)"})}(o.x,o.y,i,0);var d="food"===s?l/2:0;setTimeout(function(){t.index===X&&(function(t,e,a,r){q.d3attr(b,{fill:a,dx:0,dy:"1.1em",x:t,y:e}),"food"===s&&(q.d3attr(w,{fill:a,x:t-47,y:e}),q.d3attr(k,{x:t,y:e+14}),w.style("display","block"),k.style("display","block"));"food"===s?b.text(h.foods[r].toUpperCase()):b.text(h.countries[r].toUpperCase());"food"===s?b.style("font-size",At+"px"):b.style("font-size",qt+"px");var i=function(t,e){var a=1;return t.each(function(){for(var t=d3.select(this),r=t.text().split(/\s+/).reverse(),i=[],n=0,c=t.attr("x"),s=t.attr("y"),o=parseFloat(t.attr("dy")),l=t.text(null).append("tspan").attr("x",c).attr("y",s).attr("dy",o+"em"),d=r.pop();d;)i.push(d),l.text(i.join(" ")),l.node().getComputedTextLength()>e&&(i.pop(),l.text(i.join(" ")),i=[d],l=t.append("tspan").attr("x",c).attr("y",s).attr("dy",1*++n+o+"em").text(d),a++),d=r.pop()}),a}(b,2*(yt-yt/4));ze=i;var n=-b._groups[0][0].getBBox().height;"country"===s?n/=2:n-=i>2?At/2:i>1?At:2*At;var c=at?-H/5:0;q.d3attr(b,{transform:"translate("+c+","+n+")"}),"food"===s&&(q.d3attr(w,{transform:"translate("+c+","+(yt-yt/1.8)+")"}),q.d3attr(k,{transform:"translate("+c+","+(yt-yt/1.8)+")"}))}(o.x,o.y,i,n),function(t,e,a,r,i){"food"===s?(Jt(A,_t,r,"",0,4,function(){-1===it&&A.text("")}),_t=+r,z.text(i),e+=qt,q.d3attr(A,{fill:a,x:t,y:e}),q.d3attr(z,{fill:a,x:t,y:e+qt})):(A.empty(),q.d3attr(A,{fill:a,x:t,y:e}));var n=at?-H/5:0,e=0;1===ze?e=-At:2===ze&&(e=-At/2);q.d3attr(A,{transform:"translate("+n+","+e+")"}),q.d3attr(z,{transform:"translate("+n+","+e+")"})}(o.x,o.y,i,c,h.global.samples))},d)}}function Wt(){Mt(P),Mt(g)}function Nt(t){var r=we(t),i=d3.color(r).brighter(.25),n=[e[t]].concat(a[e[t]]);if(!((n=a[e[t]]).length<2)){var c=B.append("g");c.attr("id","efsa-pesticide-subtabs-group-"+t).attr("transform","translate("+-$+", 0)"),c.selectAll(".efsa-pesticide-subtab-space-"+t).data(n).enter().append("rect").attr("class","efsa-pesticide-subtab efsa-pesticide-subtab-space-"+t).attr("x",-1).attr("y",function(e,a){return xt+(a+2)*(G+K)+t*(G+K)-K-5}).attr("width",$).attr("height",K+5).attr("fill-default","#f4f4f4").attr("fill-brighter","#f4f4f4").attr("fill","#f4f4f4"),c.selectAll(".efsa-pesticide-subtab-"+t).data(n).enter().append("rect").attr("class","efsa-pesticide-subtab efsa-pesticide-subtab-rect efsa-pesticide-subtab-"+t).attr("x",0).attr("y",function(e,a){return xt+(a+1)*(G+K)+t*(G+K)}).attr("width",$).attr("height",G).attr("fill-default",r).attr("fill-brighter",i).attr("fill",i).append("title").html(function(t,e){return h.foods[t]}),c.selectAll(".efsa-pesticide-subtab-text-"+t).data(n).enter().append("text").style("font-size",(qt+At)/2+"px").attr("class","efsa-pesticide-subtab-text efsa-pesticide-subtab-text-"+t).attr("x",10).attr("y",function(e,a){return xt+(a+1)*(G+K)+t*(G+K)+G/2+5}).text(function(t,e){var a=h.foods[t];return a&&a.length>50&&(a=a.substring(0,52)+"..."),a})}}function St(t){if(!et){q.d3stopPropagation();var a=e.indexOf(t);if(null!==tt)return tt===a?void 0:void It();Zt(),Qt(!1),xe(!1),Ht(a),fe(function(){o(t)})}}function It(){null!==tt&&(d3.selectAll(".efsa-pesticide-tab-title").transition().duration(l/2).attr("transform","translate("+-($-(J+30))+",0)"),d3.select("#efsa-pesticide-subtabs-group-"+tt).transition().duration(l/3).attr("transform","translate("+-$+", 0)"),Et(d3.selectAll(".efsa-pesticide-tab-text")),tt=null)}function Qt(t){g.attr("pointer-events","none"),t?g.transition().duration(l).attr("stroke-width",0).attr("r",10).on("end",function(){Et(g)}):Et(g)}function Zt(){b.text(""),A.text(""),z.text(""),"food"===s&&(w.style("display","none"),k.style("display","none"))}function Ht(t){tt=t,function(t){d3.select("#efsa-pesticide-subtabs-group-"+t).transition().duration(l/3).attr("transform","translate(0, 0)")}(t),ut=!1,setTimeout(function(){d3.select(d3.selectAll(".efsa-pesticide-tab-title")._groups[0][t]).transition().duration(l).attr("transform","translate(0, 0)").on("end",function(){setTimeout(function(){ut=!0},2*l)})},10)}function jt(){!function(){v=T.selectAll(".efsa-pesticide-food").data(ke).enter().append("circle").attr("id",function(t,e){return"efsa-pesticide-food-"+e}).attr("class","efsa-pesticide-food").attr("stroke-width",0).attr("r",function(t){return t.radius}).attr("r-val",function(t){return t.radius}).attr("data-category",function(t){return t.category}).attr("data-subcategory",function(t){return t.subcategory}).attr("data-food",function(t){return t.food}).attr("fill-val",function(t){return"food"===s?we(t.cluster):m}).attr("fill",function(t){return"food"===s?we(t.cluster):m}).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("cx-val",function(t){return t.x}).attr("cy-val",function(t){return t.y}).style("cursor","pointer"),"country"===s&&v.each(function(t,e){var a=d3.select(this);T.append("text").style("opacity","0").attr("class","country-code").attr("text-anchor","middle").attr("x",a.attr("cx")).attr("y",+a.attr("cy")).text(t.countrycode).attr("fill",y).attr("font-weight","700").attr("font-size",At).transition().duration(500).delay(function(){return 1e3+30*e}).style("opacity","1")});"country"===s&&v.attr("stroke",bt).attr("stroke-width",gt);var t=[1,2,3,4];D.selectAll(".efsa-pesticide-expanded-circle-rect").data(t).enter().append("rect").attr("class","efsa-pesticide-expanded-circle-rect").attr("id",function(t,e){return"efsa-pesticide-expanded-circle-rect-"+e}).attr("y",function(t,e){return ht/10-ht+e*(G+5)}).attr("height",G).style("display","none"),D.selectAll(".efsa-pesticide-expanded-circle-rect-text").data(t).enter().append("text").style("font-size",function(t,e){return(0===e?qt:(qt+At)/2)+"px"}).attr("class","efsa-pesticide-expanded-circle-rect-text").attr("id",function(t,e){return"efsa-pesticide-expanded-circle-rect-text-"+e}).attr("y",function(t,e){return ht/10-ht+e*(G+5)+G/2+(0===e?qt:(qt+At)/2)/2.5}),"food"===s&&D.append("image").attr("xlink:href","assets/sub-category.png").style("display","none").style("pointer-events","none").attr("height",.7*G).attr("width",.7*G).attr("x",ht+ht/10+2).attr("y",function(t,e){return ht/10-ht+2*(G+5)+3}).attr("id","efsa-pesticide-expanded-circle-rect-icon-sub-category");"country"===s&&(D.append("image").attr("xlink:href","assets/pie chart.png").style("display","none").style("pointer-events","none").attr("height",.7*G).attr("width",.7*G).attr("class","efsa-pesticide-expanded-circle-rect-icon").attr("id","efsa-pesticide-expanded-circle-rect-icon-pie-chart").attr("y",function(){return ht/10-ht+1*(G+5)+.15*G}).attr("x",ht+ht/9*1-G),D.append("image").attr("xlink:href","assets/map marker.png").style("display","none").style("pointer-events","none").attr("height",.7*G).attr("width",.7*G).attr("class","efsa-pesticide-expanded-circle-rect-icon").attr("id","efsa-pesticide-expanded-circle-rect-icon-map-marker").attr("y",function(){return ht/10-ht+2*(G+5)+.15*G}).attr("x",ht+ht/9*2-G));if(g=D.append("circle").attr("r",0).attr("fill","white").attr("stroke-width",0).attr("pointer-events","none"),b=D.append("text").attr("class","efsa-pesticide-clicked-circle-text").style("font-size",At+"px"),A=D.append("text").attr("class","efsa-pesticide-clicked-circle-text").style("font-weight","700").style("font-size",qt+"px"),z=D.append("text").attr("class","efsa-pesticide-clicked-circle-text").style("font-weight","300").style("font-size",At+"px"),"food"===s){w=D.append("rect").attr("rx",10).attr("ry",10).attr("width",94).attr("height",20).attr("pointer-events","none").style("display","none"),k=D.append("text").attr("fill","white").attr("font-size","10px").text(h.global.see_results).attr("pointer-events","none").attr("text-anchor","middle").style("font-weight","400").style("display","none");var e=0;zt||Tt||Ct?e=5*k.text().length:(k.style("display","block"),e=k._groups[0][0].getBBox().width,k.style("display","none")),e>85&&k.attr("font-size","9px")}"food"===s?le():"country"===s&&(le(),Et(E),Et(M),M.selectAll("*").remove(),U.append("g").attr("class","efsa-pesticide-expanded-circle-pie"),Et(U),function(){var t=-ht/2.2+3*qt,e=-ht/2.2+10*qt;F.append("text").attr("class","efsa-pesticide-expanded-circle-text-for-country").attr("x",0).attr("y",-ht/1.5).style("font-size",qt+"px").text(""),F.append("text").attr("class","efsa-pesticide-expanded-circle-text-for-country").attr("x",0).attr("y",t).style("font-size",2*qt+"px").text(""),F.append("text").attr("class","efsa-pesticide-expanded-circle-text-for-country").attr("x",0).attr("y",-ht/2.2+5*qt).style("font-size",qt+"px").text(""),F.append("text").attr("class","efsa-pesticide-expanded-circle-text-for-country").attr("x",0).attr("y",e).style("font-size",2*qt+"px").text(""),F.append("text").attr("class","efsa-pesticide-expanded-circle-text-for-country").attr("x",0).attr("y",-ht/2.2+12*qt).style("font-size",qt+"px").text(""),F.append("text").attr("class","efsa-pesticide-expanded-circle-text-for-country").attr("x",0).attr("y",-ht/2.2+13*qt).style("font-size",qt+"px").text(""),F.append("line").attr("class","efsa-pesticide-expanded-circle-line").attr("x1",-ht/2).attr("y1",-ht/2).attr("x2",+ht/2).attr("y2",-ht/2),F.append("line").attr("class","efsa-pesticide-expanded-circle-line").attr("x1",-ht/2).attr("y1",(e+t)/2).attr("x2",+ht/2).attr("y2",(e+t)/2)}())}(),setTimeout(function(){!function(e){"food"===s&&(L.selectAll(".efsa-pesticide-tab-title").data(e).enter().append("rect").attr("class","efsa-pesticide-tab-title"),L.selectAll(".efsa-pesticide-tab-title-text").data(e).enter().append("text").style("font-size",(qt+At)/2+"px").attr("class","efsa-pesticide-tab-title-text").attr("x",-300).attr("y",function(t,e){return xt+e*(G+K)+G/2+6}).text(function(t){return h.foods[t]}).transition().duration(2*l).ease(q.qeaseElastic).delay(function(t,e){return l+(e+1)*l/2}).attr("x",10),J=0,L.selectAll(".efsa-pesticide-tab-title-text").each(function(t,e){J=q.max(J,d3.select(this).node().getBBox().width)}),$=Math.max(J+30,$),L.selectAll(".efsa-pesticide-tab-title").attr("x",0).attr("y",function(t,e){return xt+e*(G+K)}).attr("width",$).attr("height",G).attr("opacity","1").attr("fill",function(t,e){return we(t)}).attr("fill-default",function(t,e){return we(t)}).attr("transform","translate("+-$+",0)").transition().duration(2*l).delay(function(t,e){return(e+1)*l/2}).attr("transform","translate("+-($-(J+30))+",0)"),L.append("rect").attr("class","efsa-pesticide-tab-title").attr("x",0).attr("y",function(t,e){return xt+-1*(G+K)}).attr("width",$).attr("height",G).attr("opacity","1").attr("fill",t.all_foods).attr("fill-default",t.all_foods).attr("transform","translate("+-$+",0)").transition().duration(2*l).delay(function(t,e){return e*l/2}).attr("transform","translate("+-($-(J+30))+",0)"),L.append("text").style("font-size",(qt+At)/2+"px").attr("class","efsa-pesticide-tab-title-text").attr("x",-300).attr("y",function(t,e){return xt+-1*(G+K)+G/2+6}).text(h.global.all_products).transition().duration(2*l).ease(q.qeaseElastic).delay(function(t,e){return l/2+l/2}).attr("x",10))}(e),_.each(e,function(t,e){Nt(e)}),O.append("path").attr("id","efsa-pesticide-tooltip").attr("width",0),O.append("text").attr("id","efsa-pesticide-tooltip-text")},200)}function Xt(t,e,a,r,i){Te=i,O.style("display","block"),d3.select("#efsa-pesticide-tooltip-text").text(a);var n=Math.ceil(d3.select("#efsa-pesticide-tooltip-text").node().getBBox().width);d3.select("#efsa-pesticide-tooltip-text").text("");var c=50+n;d3.select("#efsa-pesticide-tooltip").attr("d",function(t,e,a,r,i){return"M"+t+" "+e+" L"+t+" "+(e-r-i)+" L"+(t-a)+" "+(e-r-i)+" L"+(t-a)+" "+(e-i)+"L "+(t-i/2)+" "+(e-i)+" Z"}(t,e,c,26,14)).attr("width",c).style("stroke",r),d3.select("#efsa-pesticide-tooltip-text").attr("x",t-c/2).attr("y",e-14-26/3).text(a)}function Yt(t){setTimeout(function(){Te!==t&&-999!==t||O.style("display","none")},100)}function Jt(t,e,a,r,i,n,c){mobile&&(n/=2);var s=0,o=setInterval(function(){if((e=q.round((e+a)/2))<100){l=(l=(l=e.toFixed(i)).replace(".",Pt)).replace(",",Pt),t.text(l+r)}else t.text(q.numberWithCommas(e.toFixed(i),Lt)+r);if(++s>n){if(clearInterval(o),a<100){var l=a.toFixed(i);l=(l=l.replace(".",Pt)).replace(",",Pt),t.text(l+r)}else t.text(q.numberWithCommas(a.toFixed(i),Lt)+r);c&&c()}},40)}function Vt(t,r,i,n,c,o,d,p,f){Yt(-1);var u=!ct;ct=!0,g.attr("pointer-events","inherit"),v.style("cursor","default"),q.d3stopPropagation(),q.d3attr(g,{transform:"translate(0,0)"}),g.attr("stroke",t),t&&d3.selectAll(".efsa-pesticide-expanded-circle-rect").attr("fill",t),Zt(),setTimeout(function(){"food"===s?(Mt(E),Mt(M)):"country"===s&&Mt(F),Zt()},l);var x=e.indexOf(r),m=-1;i&&""!==i&&(m=a[r].indexOf(i)),pt=i||r,ft=f,"food"===s&&Ht(x),d3.selectAll(".efsa-pesticide-subtab-"+x).attr("transform","translate(0,0)"),d3.selectAll(".efsa-pesticide-subtab-space-"+x).attr("transform","translate(0,0)"),d3.selectAll(".efsa-pesticide-subtab-text-"+x).attr("transform","translate(0,0)");var y=null;(y=m>-1&&x<4?d3.select("#efsa-pesticide-subtabs-group-"+x).selectAll(".efsa-pesticide-subtab-rect")._groups.length?d3.select("#efsa-pesticide-subtabs-group-"+x).selectAll(".efsa-pesticide-subtab-rect")._groups[0][m]:d3.selectAll(".efsa-pesticide-tab-title")._groups[0][m]:(d3.selectAll(".efsa-pesticide-tab-title")._groups.length,d3.selectAll(".efsa-pesticide-tab-title")._groups[0][x]))&&(mobile?d3.selectAll(".efsa-pesticide-subtab").attr("fill",function(t,e){return d3.select(this).attr("fill-brighter")}):d3.selectAll(".efsa-pesticide-subtab").transition().duration(l/5).attr("fill",function(t,e){return d3.select(this).attr("fill-brighter")}),m>-1&&(mobile?d3.select(y).attr("fill",d3.select(y).attr("fill-default")):d3.select(y).transition().duration(l/5).attr("fill",d3.select(y).attr("fill-default")))),"food"===s?setTimeout(function(){u&&d3.selectAll(".efsa-pesticide-expanded-circle-rect-text").attr("x",0),function(t,e,a,r){var i=[],n=d3.select("#efsa-pesticide-expanded-circle-rect-text-1"),c=n.text();v.attr("opacity",mt),d3.selectAll(".efsa-pesticide-expanded-circle-rect-text").style("display","block").attr("text-anchor","end").text(function(a,i){if(0===i){var n=t;return n.length>50&&(n=n.substring(0,52)+"..."),n}if(1===i)return q.numberWithCommas(e,Lt)+" "+h.global.samples;if(2===i){if(r===I)return h.global.all_products;if(r===S)return h.global.back_to_subcategory;if(r===N)return h.global.back_to_category}return 3===i?"":void 0}).transition().duration(l).delay(function(t,e){return e*l}).attr("x",function(t,e){var a=d3.selectAll(".efsa-pesticide-expanded-circle-rect-text")._groups[0][e].getBBox().width+ht+ht/9*e;return i.push(a),+i[e]}),c=parseInt(c),isNaN(c)&&(c=0),Jt(n,c,e," "+h.global.samples,0,4),a&&(a.attr("fill",a.attr("fill-default")),d3.selectAll(".efsa-pesticide-expanded-circle-rect").attr("fill",a.attr("fill-default")),g.attr("stroke",a.attr("fill-default"))),d3.select("#efsa-pesticide-expanded-circle-rect-3").attr("y",a.attr("y")-j/2).attr("x",-(H/2-$+2)).attr("fill",a.attr("fill-default")).attr("width",0),d3.selectAll(".efsa-pesticide-expanded-circle-rect").attr("transform","translate(0,0)").style("display","block").style("cursor",function(t,e){return 2===e?"pointer":"default"}).transition().duration(l).delay(function(t,e){return 3===e?0:e*l}).attr("x",function(t,e){return 3===e?-(H/2-$+2):0}).attr("width",function(t,e){return 3===e?Math.max(0,H/2-($+Y/2)+2):+i[e]+10}).on("end",function(t,e){"food"===s&&0===e&&(P.select("#efsa-pesticide-expanded-circle-rect-close-food-name").remove(),P.append("rect").attr("id","efsa-pesticide-expanded-circle-rect-close-food-name").attr("x",+d3.select("#efsa-pesticide-expanded-circle-rect-0").attr("width")+2).attr("y",ht/10-ht).attr("width",G).attr("height",G).attr("fill",a.attr("fill-default")).attr("cursor","pointer").on("click",function(){ie(),P.select("#efsa-pesticide-expanded-circle-rect-close-food-name").remove(),P.select("#efsa-pesticide-expanded-circle-rect-close-food-name-text").remove()}).on("mouseover",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-food-name-text").style("text-decoration","underline")}).on("mouseout",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-food-name-text").style("text-decoration","none")}),P.select("#efsa-pesticide-expanded-circle-rect-close-food-name-text").remove(),P.append("text").attr("id","efsa-pesticide-expanded-circle-rect-close-food-name-text").attr("x",+d3.select("#efsa-pesticide-expanded-circle-rect-0").attr("width")+2+G/2).attr("y",ht/10-ht+2+G/2+At/2.5).attr("text-anchor","middle").attr("fill","white").style("font-size",1.25*qt+"px").text("x"))}),r===I?(Et(d3.select("#efsa-pesticide-expanded-circle-rect-2")),Et(d3.select("#efsa-pesticide-expanded-circle-rect-text-2"))):(Mt(d3.select("#efsa-pesticide-expanded-circle-rect-2")),Mt(d3.select("#efsa-pesticide-expanded-circle-rect-text-2"))),setTimeout(function(){r===S?(d3.select("#efsa-pesticide-expanded-circle-rect-icon-sub-category").attr("xlink:href","assets/sub-category.png"),d3.select("#efsa-pesticide-expanded-circle-rect-icon-sub-category").style("display","block")):r===N&&(d3.select("#efsa-pesticide-expanded-circle-rect-icon-sub-category").attr("xlink:href","assets/category.png"),d3.select("#efsa-pesticide-expanded-circle-rect-icon-sub-category").style("display","block"))},2.5*l)}(h.foods[n],c,d3.select(y),f)},u&&"food"===s?l:0):"country"===s&&setTimeout(function(){!function(t,e,a){d3.selectAll(".efsa-pesticide-expanded-circle-text-for-country").text(function(r,i){if(0===i)return h.countries[t].toUpperCase();if(1===i)return q.numberWithCommas(e,Lt);if(2===i)return h.global.samples.toUpperCase();if(3===i){var n=e/(a/1e5),c=n.toFixed(1),s=(c=(c=c.replace(",","x")).replace(".","x")).split("x")[1];return c=q.numberWithCommas(q.floor(n),Lt),c=c.replace(",",Lt),c=c.replace(".",Lt),c+=Pt+s}return 4===i?h.global.samples_100000.toUpperCase():5===i?h.global.inhabitants.toUpperCase():""}),Jt(d3.select(d3.selectAll(".efsa-pesticide-expanded-circle-text-for-country")._groups[0][1]),0,e,"",0,4),Jt(d3.select(d3.selectAll(".efsa-pesticide-expanded-circle-text-for-country")._groups[0][3]),0,e/(a/1e5),"",1,4);var r=[];d3.selectAll(".efsa-pesticide-expanded-circle-rect-text").attr("transform","translate(0,0)").style("display",function(t,e){return e>0&&e<3?"block":"none"}).style("font-weight","300").text(function(e,a){if(0===a){if("food"===s)return t.toUpperCase();if("country"===s)return h.countries[t].toUpperCase()}return 1===a?h.global.overall_results:2===a?h.global.origin_of_samples:3===a?"":void 0}).attr("x",0).transition().duration(l).delay(function(t,e){return l+e*l/4}).attr("x",function(t,e){d3.selectAll(".efsa-pesticide-expanded-circle-rect-text").style("display","block");var a=+d3.selectAll(".efsa-pesticide-expanded-circle-rect-text")._groups[0][e].getBBox().width+ht+ht/9*e;return"country"===s&&0===e&&(a-=ht/9),r.push(a),0===e?-a:ht+ht/9*e}),d3.selectAll(".efsa-pesticide-expanded-circle-rect").attr("transform","translate(0,0)").style("display",function(t,e){return e>=0&&e<3?"block":"none"}).style("cursor",function(t,e){return e>0&&e<3?"pointer":"default"}).attr("x",function(t,e){return 0}).transition().duration(l).delay(function(t,e){return e*l/4}).attr("x",function(t,e){return 0===e?-r[e]-10:0}).attr("width",function(t,e){return+r[e]+10}).on("end",function(t,e){"country"===s&&0===e&&(P.select("#efsa-pesticide-expanded-circle-rect-close-all").remove(),P.append("rect").attr("id","efsa-pesticide-expanded-circle-rect-close-all").attr("x",-d3.select("#efsa-pesticide-expanded-circle-rect-0").attr("width")-G-2).attr("y",ht/10-ht).attr("width",G).attr("height",G).attr("fill","#a8a8a8").attr("cursor","pointer").on("click",function(){ie()}).on("mouseover",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-all-text").style("text-decoration","underline")}).on("mouseout",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-all-text").style("text-decoration","none")}),P.select("#efsa-pesticide-expanded-circle-rect-close-all-text").remove(),P.append("text").attr("id","efsa-pesticide-expanded-circle-rect-close-all-text").attr("x",-d3.select("#efsa-pesticide-expanded-circle-rect-0").attr("width")-G-2+G/2).attr("y",ht/10-ht+G/2+At/2.5).attr("text-anchor","middle").attr("fill","white").style("font-size",1.25*qt+"px").text("x"))}),setTimeout(function(){d3.select("#efsa-pesticide-expanded-circle-rect-icon-pie-chart").attr("transform","translate(0,0)").style("display","block"),d3.select("#efsa-pesticide-expanded-circle-rect-icon-map-marker").attr("transform","translate(0,0)").style("display","block")},2*l)}(n,c[0],c[1])},u?l:0),Mt(P),Mt(g),g.attr("cx",0).attr("cy",0),"food"===s?re(o,d,p):g.attr("stroke-width",ht/10).transition().duration(l).attr("r",ht)}function Gt(t,e,r,i,n){d3.selectAll(".efsa-pesticide-expanded-circle-pie").selectAll("*").remove();var c=lt?0:l;lt=!0,g.attr("stroke-width",ht/10).transition().duration(c).attr("r",ht).on("end",function(){var s=["#e8e8e8","#e8e8e8","#e8e8e8","#e8e8e8","#3186d3","#dd6c31","#ac56c1","#33b53c"],o=["#e8e8e8","#e8e8e8","#e8e8e8","#e8e8e8","#1166b3","#bd4c11","#8c36a1","#13951c"],d=[t,e,r,i],p=t+e+r+i,f=1/p*d[0],u=1/p*d[1],x=1/p*d[2],m=1/p*d[3],y=" "+(100*f).toFixed(1).replace(".",Pt).replace(",",Pt)+"%",v=" "+(100*u).toFixed(1).replace(".",Pt).replace(",",Pt)+"%",g=" "+(100*x).toFixed(1).replace(".",Pt).replace(",",Pt)+"%",b=" "+(100*m).toFixed(1).replace(".",Pt).replace(",",Pt)+"%",w=[h.composition_chart.domestic_samples+y,h.composition_chart.eea_countries+v,h.composition_chart.third_countries+g,h.composition_chart.unknown_origin+b],_=c;d=d.sort(function(t,e){return t>e?-1:t<e?1:0});var k=ht-ht/15;ue(d3.select(".efsa-pesticide-expanded-circle-pie"),0,1,s[0],_,k+k/35-k/5,k,function(){}),ue(d3.select(".efsa-pesticide-expanded-circle-pie"),0,1,s[1],_/2,k+k/35-k/5*2,k-k/5,function(){}),ue(d3.select(".efsa-pesticide-expanded-circle-pie"),0,1,s[2],_/3,k+k/35-k/5*3,k-k/5*2,function(){}),ue(d3.select(".efsa-pesticide-expanded-circle-pie"),0,1,s[3],_/4,k+k/35-k/5*4,k-k/5*3,function(){}),ue(d3.select(".efsa-pesticide-expanded-circle-pie"),0,f,s[4],2*_,k+k/35-k/5,k,function(){}),ue(d3.select(".efsa-pesticide-expanded-circle-pie"),0,u,s[5],1.5*_,k+k/35-k/5*2,k-k/5,function(){}),ue(d3.select(".efsa-pesticide-expanded-circle-pie"),0,x,s[6],_,k+k/35-k/5*3,k-k/5*2,function(){}),ue(d3.select(".efsa-pesticide-expanded-circle-pie"),0,m,s[7],_/1.5,k+k/35-k/5*4,k-k/5*3,function(){d3.select(".efsa-pesticide-expanded-circle-pie").selectAll("path").style("cursor","pointer").on("mousemove",function(t,e){"#e8e8e8"!==d3.select(this).attr("fill")&&function(t,e,a,r){d3.select(t).attr("opacity",1),d3.select(t).transition().duration(l/3).attr("fill",r),Xt(+d3.event.x+2,+d3.event.y-60,e[a],r,-1)}(this,w,e-4,o[e])}).on("mouseout",function(t,e){Yt(-1),function(t,e){d3.select(t).attr("opacity",1),d3.select(t).transition().duration(l/2).attr("fill",e)}(this,s[e])}).on("click",function(t,e){q.d3stopPropagation(),e>3&&(Yt(-1),4==e?ga("send","event",{eventCategory:"Pesticides origin chart",eventAction:"EEA",eventLabel:"EEA"}):5==e?ga("send","event",{eventCategory:"Pesticides origin chart",eventAction:"Domestic",eventLabel:"Domestic"}):6==e?ga("send","event",{eventCategory:"Pesticides origin chart",eventAction:"Third Countries",eventLabel:"Third Countries"}):7==e&&ga("send","event",{eventCategory:"Pesticides origin chart",eventAction:"Unknown origin",eventLabel:"Unknown origin"}),$t(n,a,!1,!0,0,[kt[e-4]]))})});var A=mobile?70:80;d3.select(".efsa-pesticide-expanded-circle-pie").append("image").attr("xlink:href","assets/pie-chart-icon.png").style("cursor","pointer").attr("x",-A/2).attr("y",-A/2).attr("width",A).attr("height",A).on("mouseover",function(){d3.select(this).attr("xlink:href","assets/pie-chart-icon-over.png")}).on("mouseout",function(){d3.select(this).attr("xlink:href","assets/pie-chart-icon.png")}).on("click",function(t,e){q.d3stopPropagation(),Yt(-1),ga("send","event",{eventCategory:"Pesticides origin chart",eventAction:"All",eventLabel:"All"}),$t(n,a,!1,!0,0,null)})})}function Kt(t){var e=d3.select(".efsa-composition-chart-legend-item-"+t+"-text").classed("efsa-pesticide-composition-chart-filter-inactive");d3.select(".efsa-composition-chart-legend-item-"+t+"-text").classed("efsa-pesticide-composition-chart-filter-inactive",!e)}function $t(t,e,a,r,c,s){var o=r?l:0;(ct||st)&&ne(),Et(T),Et(E),Et(M);var d=kt,p=[h.composition_chart.domestic_samples,h.composition_chart.eea_countries,h.composition_chart.third_countries,h.composition_chart.unknown_origin],f=[];if(s)f=s;else for(Q=0;Q<4;Q++){var u=d3.select(".efsa-composition-chart-legend-item-"+Q+"-text");u.node()&&u.classed("efsa-pesticide-composition-chart-filter-inactive")||f.push(d[Q])}C.empty(),C.html(""),C.node().innerHTML="",C.selectAll("*").remove(),C.style("opacity","1"),C.append("rect").attr("x",0).attr("y",0).attr("width",H).attr("height",j).attr("fill","#f4f4f4"),C.append("rect").attr("x",H-70).attr("y",0).attr("width",50).attr("height",50).attr("fill","#f4f4f4").on("click",function(){he()}),C.append("text").style("pointer-events","auto").style("cursor","pointer").attr("x",H-45).attr("y",4.6*qt).text("x").attr("font-size","36px").on("mouseover",function(){d3.select(this).style("text-decoration","underline")}).on("mouseout",function(){d3.select(this).style("text-decoration","none")}).on("click",function(){he()});var x,m={Domestic:{normal:"#0b4e99",brighter:"#61a1db"},EU:{normal:"#dd6c31",brighter:"#e28e61"},TC:{normal:"#ac56c1",brighter:"#be7dcd"},UN:{normal:"#33b53c",brighter:"#63c46a"}};if(a){x=[];for(var y in i.composition){var v=i.composition[y];for(var b in v)v[b].country===t&&x.push({country:y,type:v[b].type,samples:v[b].samples})}}else x=i.composition[t];var w=0;for(var _ in x)w+=x[_].samples;x=x.filter(function(t){return f.indexOf(t.type)>-1});var k=0,A=0;for(var _ in x)k=Math.max(k,x[_].samples),A+=x[_].samples;x=x.sort(function(t,e){return t=n(h.countries[t.country]),e=n(h.countries[e.country]),t<e?-1:t>e?1:0});var z=H/3.8,L=H/100,B=H/100,O=j/35,D=H/10,R=22;H<1111&&(R=10,O*=1.75);var W=6*O,N=d3.scaleLinear().domain([0,k]).range([0,z]),S=H-D-z-B;C.append("text").attr("x",H/2).attr("y",2*qt).attr("text-anchor","middle").attr("fill","#202020").attr("font-size",qt).attr("font-weight","400").text(h.composition_chart.title);for(var I=H/70,Q=0;Q<4;Q++)!function(r){var i=f.indexOf(d[r])<0?" efsa-pesticide-composition-chart-filter-inactive ":"",n=H/6*(r+1)+I/2,c=m[d[r]].normal,s=n+I,o=3.5*qt,l=o+H/70;if(H<1025&&(s+=2,l+=2),H<800&&(n-=3,o-=3),C.append("rect").attr("x",n).attr("width",s-n).attr("y",o).attr("height",l-o).attr("fill","transparent").style("cursor","pointer").on("click",function(){Kt(r),setTimeout(function(){$t(t,e,a,!0,0,null)},50)}).on("mouseover",function(){d3.selectAll(".efsa-composition-chart-legend-item-"+r+"-close").attr("opacity",.5)}).on("mouseout",function(){d3.selectAll(".efsa-composition-chart-legend-item-"+r+"-close").attr("opacity",1)}),C.append("text").attr("class","efsa-composition-chart-legend-item efsa-composition-chart-legend-item-"+r+"-text efsa-composition-chart-legend-item-"+r+i).attr("x",n+I+5).attr("y",3.6*qt+I-At/2+(mobile?3:0)).attr("font-weight","400").attr("font-size",H<800?"10px":H<1025?"13px":"15px").attr("fill",c).text(p[r]),i){b="M"+(n+=u=2)+","+(o+=u)+" L"+(s-=u)+","+o+" L"+s+","+(l-=u)+" L"+n+","+l+" Z"}else{var u=2,x=(n+=u)+((s-=u)-n)/2,y=(o+=u)+((l-=u)-o)/2;b="M"+n+","+o+" L"+s+","+o+" L"+s+","+l+" L"+n+","+l+" Z M"+(x-3)+","+y+" L"+(x-1)+","+(y+3)+" L"+(x+4)+","+(y-3)}C.append("path").attr("class","efsa-composition-chart-legend-item efsa-composition-chart-legend-item-"+r+"-close efsa-composition-chart-legend-item-"+r).attr("d",b).attr("stroke",c).attr("fill","transparent").attr("stroke-width","2px").style("pointer-events","none")}(Q);var Z=W-2*O;C.append("rect").attr("x",L).attr("y",Z).attr("width",H/2-L-1).attr("height",1.5*O).attr("fill","#dbdbdb"),C.append("rect").attr("x",H/2+1).attr("y",Z).attr("width",H/2-B-1).attr("height",1.5*O).attr("fill","#dbdbdb"),C.append("text").attr("x",L+15).attr("y",Z+1.5*qt).attr("fill","#202020").style("font-size",qt+"px").attr("font-weight","400").text(h.composition_chart.origin),C.append("text").attr("x",H-B-15).attr("y",Z+1.5*qt).attr("fill","#202020").text(h.composition_chart.analysing_countries).style("font-size",qt+"px").attr("font-weight","400").attr("text-anchor","end"),Mt(C);for(var X=x.length<c+R?x.length:c+R,Y=D+z,Q=c;Q<X;Q++){var J=a?H-Y-B:L,V=a?J:L+D+z-N(x[Q].samples),$=N(x[Q].samples),tt=(Q-c)*(O+5)+W,et=O,at=a?H-B-5:J+5,rt=a?"end":"start";!function(t,r){C.append("rect").attr("x",J).attr("width",Y).attr("y",tt).attr("height",O).attr("fill","#ffffff").style("cursor","pointer").on("click",function(t,i){q.d3stopPropagation(),$t(r,e,!a,!0,0,null)}).on("mouseover",function(e,a){ee(this,"#composition-chart-text-origin-"+t)}).on("mouseout",function(e,a){ae(this,"#composition-chart-text-origin-"+t,"#ffffff","#202020")})}(Q,x[Q].country);var it=h.countries[x[Q].country];it=it||x[Q].country,C.append("text").attr("id","composition-chart-text-origin-"+Q).attr("x",at).attr("y",tt+1.5*At).attr("text-anchor",rt).attr("fill","#202020").attr("font-size",At+"px").text(x[Q].country===t?h.global.domestic+" ("+q.numberWithCommas(x[Q].samples,Lt)+")":(it.length>50?it.substr(0,48)+"..":it)+" ("+q.numberWithCommas(x[Q].samples,Lt)+")"),C.append("rect").attr("x",V).attr("width",$).attr("y",tt).attr("height",et).style("pointer-events","none").attr("fill",m[x[Q].type].normal).attr("opacity",0).transition().delay(r?20*Q:0).duration(o).attr("opacity",1);b=a?"M"+J+","+tt+" L"+(D+z+L)+","+(et/2+W)+" L"+J+","+(tt+et)+" Z":"M"+(V+$)+","+tt+" L"+S+","+(et/2+W)+" L"+(V+$)+","+(tt+et)+" Z";C.append("path").attr("d",b).attr("fill",m[x[Q].type].brighter).attr("opacity",0).transition().delay(r?20*Q:0).duration(o).attr("opacity",1)}c<x.length-R+1&&C.append("image").attr("xlink:href","assets/menu arrow down b.png").attr("x",a?H-Y/1.5-25:Y/1.5-25).attr("y",j-1.5*O).attr("height",O/1.3).attr("width",O/1.3).style("cursor","pointer").on("click",function(){q.d3stopPropagation(),$t(t,e,a,!1,c+1,null)}),c>0&&C.append("image").attr("xlink:href","assets/menu arrow up b.png").attr("x",a?H-Y/1.5+25:Y/1.5+25).attr("y",j-1.5*O).attr("height",O/1.3).attr("width",O/1.3).style("cursor","pointer").on("click",function(){q.d3stopPropagation(),$t(t,e,a,!1,c-1,null)}),C.on("mousewheel",null),C.on("wheel",null);var nt=x.length-R+1,ot=Ct?"mousewheel":"wheel";!function(t,e,a,r,i){C.on(ot,function(n,c){var s=d3.event.wheelDelta||d3.event.deltaY;(Tt||zt)&&(s=-s),s<0&&r<i&&$t(t,e,a,!1,r+1,null),s>0&&r>0&&$t(t,e,a,!1,r-1,null)})}(t,e,a,c,nt),C.append("rect").attr("x",a?B:S).attr("width",D+z).attr("y",0+W).attr("height",O).attr("fill","#0b4e99"),C.append("text").attr("x",a?B+5:S+5).attr("y",0+1.3*At+W).attr("fill","#ffffff").style("font-size",At+"px").text(h.countries[t]?h.countries[t]+" ("+q.numberWithCommas(A,Lt)+")":t+" ("+q.numberWithCommas(A,Lt)+")"),C.append("image").attr("xlink:href","assets/menu arrow down.png").attr("x",a?D+z-O/2-10:S+D+z-O/2-10).attr("y",0+W+O/2-O/4).attr("height",O/2).attr("width",O/2).style("cursor","pointer").on("click",function(){q.d3stopPropagation(),Mt(d3.selectAll(".composition-chart-dropdown-analysing"))}),C.append("image").attr("xlink:href","assets/pie chart.png").attr("x",a?D+z-3*O/2-10:S+D+z-3*O/2-10).attr("y",0+W+O/2-O/4).attr("height",O/2).attr("width",O/2).style("cursor","pointer").on("click",function(){q.d3stopPropagation();var e=a?Ot[t].value_below_loq:Bt[t].value_below_loq,r=a?Ot[t].value_below_mrl:Bt[t].value_below_mrl,i=a?Ot[t].value_above_mrl:Bt[t].value_above_mrl;!function(t,e,a,r,i,n,c){q.d3stopPropagation(),d3.selectAll(".efsa-pesticide-expanded-circle-text").style("display","none"),st=!0,Mt(d3.select("#composition-chart-cover")),Mt(g),Mt(P),Et(F),Et(U),Mt(E),Mt(M),g.attr("stroke-width",ht/10).transition().duration(l).attr("r",ht).on("end",function(){re(e,a,r);var i=h.countries[t];i=i||t,d3.select("#efsa-pesticide-expanded-circle-rect-text-0").style("display","block").text(h.global.all_countries),d3.select("#efsa-pesticide-expanded-circle-rect-text-1").style("display","block").text(i+" | "+q.numberWithCommas(c,Lt)+" "+h.global.samples).attr("transform","translate("+-ht/10+",0)"),d3.select("#efsa-pesticide-expanded-circle-rect-0").attr("x",0).attr("width",0).attr("transform","translate(0,0)").style("display","block").style("cursor","pointer"),d3.select("#efsa-pesticide-expanded-circle-rect-1").attr("x",0).attr("width",0).attr("transform","translate(0,0)").style("display","block").style("cursor","default"),d3.select("#efsa-pesticide-expanded-circle-rect-text-0").attr("x",0).attr("width",0).attr("transform","translate(0,0)").style("display","block"),d3.select("#efsa-pesticide-expanded-circle-rect-text-1").attr("x",0).attr("width",0).attr("transform","translate(0,0)").style("display","block");var s=d3.select("#efsa-pesticide-expanded-circle-rect-text-0")._groups[0][0].getBBox().width,o=d3.select("#efsa-pesticide-expanded-circle-rect-text-1")._groups[0][0].getBBox().width;if(n){var d=ht+ht/9+s,p=G+K+K;d3.select("#efsa-pesticide-expanded-circle-rect-0").attr("transform","translate(0,"+p+")"),d3.select("#efsa-pesticide-expanded-circle-rect-0").transition().duration(l).attr("width",d).attr("transform","translate(0,"+p+")"),d3.select("#efsa-pesticide-expanded-circle-rect-text-0").attr("transform","translate(0,"+p+")"),d3.select("#efsa-pesticide-expanded-circle-rect-text-0").transition().duration(l).attr("transform","translate("+(d-s-15)+","+p+")");f=ht+ht/9+o;d3.select("#efsa-pesticide-expanded-circle-rect-1").transition().duration(l).attr("width",f).attr("transform","translate("+-f+",0)"),d3.select("#efsa-pesticide-expanded-circle-rect-text-1").transition().duration(l).attr("transform","translate("+-(f-15)+",0)")}else{var d=ht+ht/9+s,p=G+K+K;d3.select("#efsa-pesticide-expanded-circle-rect-0").attr("transform","translate(0,"+p+")"),d3.select("#efsa-pesticide-expanded-circle-rect-0").transition().duration(l).attr("width",d).attr("transform","translate("+-d+","+p+")"),d3.select("#efsa-pesticide-expanded-circle-rect-text-0").attr("transform","translate(0,"+p+")"),d3.select("#efsa-pesticide-expanded-circle-rect-text-0").transition().duration(l).attr("transform","translate("+-(d-15)+","+p+")");var f=ht+ht/9+o;d3.select("#efsa-pesticide-expanded-circle-rect-1").transition().duration(l).attr("width",f),d3.select("#efsa-pesticide-expanded-circle-rect-text-1").transition().duration(l).attr("transform","translate("+(f-o-15)+",0)")}P.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut").remove(),P.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut-text").remove(),setTimeout(function(){if(P.append("rect").attr("id","efsa-pesticide-expanded-circle-rect-close-composition-donut").attr("x",f+2).attr("y",ht/10-ht+G+5+(n?K:0)).attr("width",G).attr("height",G).attr("fill","#a8a8a8").attr("cursor","pointer").on("click",function(){q.d3stopPropagation(),Et(E),Et(M),M.selectAll("*").remove(),d3.select(this).remove(),ie()}).on("mouseover",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut-text").style("text-decoration","underline")}).on("mouseout",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut-text").style("text-decoration","none")}),P.append("text").attr("id","efsa-pesticide-expanded-circle-rect-close-composition-donut-text").attr("x",f+2+G/2).attr("y",ht/10-ht+G+5+G/2+At/2.5+(n?K:0)).attr("text-anchor","middle").attr("fill","white").style("font-size",1.25*qt+"px").text("x"),n){var t=P.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut"),e=+t.attr("x"),a=+t.attr("width");t.attr("transform","translate("+-(2*e+a)+","+-K+")");var e=+(t=P.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut-text")).attr("x"),a=+t.attr("width");t.attr("transform","translate("+-(2*e+a)+","+-K+")")}},l)})}(t,e,r,i,0,a,w)});var lt;if(a){lt=[];for(var dt in Ot)lt.push(dt);lt=lt.sort(function(t,e){return t=n(h.countries[t]),e=n(h.countries[e]),t>e?1:t<e?-1:0})}else lt=e.countries.sort(function(t,e){return t=n(h.countries[t]),e=n(h.countries[e]),t>e?1:t<e?-1:0});te(0,j>800?32:20,lt,a,L,S,W,O,D,z,!1),C.append("rect").attr("id","composition-chart-cover").attr("x",0).attr("y",W-5).attr("width",H).attr("height",j-W).attr("fill","#ffffff").attr("opacity",.85).style("display","none")}function te(t,e,r,i,n,c,s,o,l,d,p){C.selectAll(".composition-chart-dropdown-analysing").remove();for(var f=1.4*At,u=Ct?"mousewheel":"wheel",x=0,m=t,y=r.length;m<e&&m<y;m++)!function(i,m,v){var g=0+s+(i-t+1)*f+o-At;x=g,C.append("rect").attr("class","composition-chart-dropdown-analysing").style("display",p?"block":"none").attr("x",v?n:c).attr("y",g).attr("width",l+d).attr("height",f).attr("fill","#eaeaea").style("cursor","pointer").on("click",function(t,e){q.d3stopPropagation(),$t(m,a,!!v,!0,0,null)}).on("mouseover",function(t,e){ee(this,"#composition-chart-text-analysing-"+i)}).on("mouseout",function(t,e){ae(this,"#composition-chart-text-analysing-"+i,"#eaeaea","#202020")}).on(u,function(a,i){q.d3stopPropagation();var p=d3.event.wheelDelta||d3.event.deltaY;(Tt||zt)&&(p=-p),p<0?(e<y&&(t+=7,e+=7),te(t,e,r,v,n,c,s,o,l,d,!0)):(t>6&&(t-=7,e-=7),te(t,e,r,v,n,c,s,o,l,d,!0))});var b=h.countries[m];b=b||m,C.append("text").attr("class","composition-chart-dropdown-analysing").style("display",p?"block":"none").attr("id","composition-chart-text-analysing-"+i).attr("x",v?n+5:c+5).attr("y",g+At).attr("fill","#202020").attr("font-size",At+"px").style("cursor","pointer").text(b)}(m,r[m],i);t<r.length-(e-t)&&C.append("image").attr("class","composition-chart-dropdown-analysing").style("display",p?"block":"none").attr("xlink:href","assets/menu arrow down b.png").attr("x",i?50:H-80).attr("y",x+o).attr("height",o/1.7).attr("width",o/1.7).style("cursor","pointer").on("click",function(){q.d3stopPropagation(),te(t+=7,e+=7,r,i,n,c,s,o,l,d,!0)}),t>0&&C.append("image").attr("class","composition-chart-dropdown-analysing").style("display",p?"block":"none").attr("xlink:href","assets/menu arrow up b.png").attr("x",i?80:H-50).attr("y",x+o).attr("height",o/1.7).attr("width",o/1.7).style("cursor","pointer").on("click",function(){q.d3stopPropagation(),te(t-=7,e-=7,r,i,n,c,s,o,l,d,!0)})}function ee(t,e){d3.select(t).attr("fill","#3878b2"),d3.select(e).attr("fill","#ffffff")}function ae(t,e,a,r){d3.select(t).attr("fill",a),d3.select(e).attr("fill",r)}function re(t,e,a){var r=10;ot||(r=10,d3.selectAll(".efsa-pesticide-expanded-circle-text").style("display","none").transition().duration(0).delay(function(t,e){return 2*l+30*e}).style("display","block"),ot=!0),g.attr("stroke-width",ht/10).transition().duration(l).attr("r",ht).on("end",function(){var i=t,n=e,c=a,s=[i,n,c];i/=100,n/=100,c/=100;for(var o=d3.selectAll(".efsa-pesticide-expanded-circle-text-value"),u=0;u<3;u++){var x=d3.select(o._groups[0][u]),m=parseInt(x.text());isNaN(m)&&(m=0),Jt(x,m,s[u],"%",1,r)}var y=l/2,h=ht-ht/10-ht/20-ht/10,v=ht-ht/10-ht/20;ue(M,0,i,d,y*i,h,v,function(){ue(M,i,i+n,p,y*n,h,v,function(){ue(M,i+n,i+n+c,f,y*c,h,v)})}),setTimeout(function(){for(var t=1;t<=3;t++){var e=d3.select("#efsa-pesticide-expanded-circle-text-"+t)._groups[0][0].getBBox().width;d3.select("#efsa-pesticide-expanded-circle-text-"+t+"c").attr("cx",-e/2-5)}},3*l)})}function ie(){ut&&!et&&(wt||It(),Dt(),"food"===s&&at&&pe(!0),wt&&(wt=!1),(ct||st)&&ne(),mobile&&-1!==it&&Ut(0,0,!1),v.style("cursor","pointer"),P.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut").remove(),P.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut-text").remove(),P.select("#efsa-pesticide-expanded-circle-rect-close-food-name").remove(),P.select("#efsa-pesticide-expanded-circle-rect-close-food-name-text").remove(),Et(d3.selectAll(".composition-chart-dropdown-analysing")),rt=-1,st&&setTimeout(function(){Et(d3.select("#composition-chart-cover"))},2*l))}function ne(){me(),Zt(),Et(E),Et(M),Et(U),Et(F),function(t){d3.selectAll(".efsa-pesticide-expanded-circle-rect-text").attr("x","0"),d3.selectAll(".efsa-pesticide-expanded-circle-rect-text").text(""),d3.selectAll(".efsa-pesticide-expanded-circle-rect-text-for-country").text("");var e=!1;d3.selectAll(".efsa-pesticide-expanded-circle-rect").transition().duration(l).attr("width",0).attr("transform",function(t,e){var a=d3.select(this).attr("x"),r=0;return d3.select(this).attr("transform")&&(r=q.cssTransformTranslateValues(d3.select(this).attr("transform")).y),a<0?"translate("+-a+","+r+")":"translate(0,"+r+")"}).on("end",function(){e||(e=!0,t())})}(function(){xe(!0),Dt(),Qt(!0),ct=!1,pt=null,ft=null,st=!1,nt=!1,ot=!1,lt=!1})}function ce(){nt||("country"===s&&d3.selectAll(".country-code").each(function(t,e){d3.select(this).attr("x",d3.select("#efsa-pesticide-food-"+e).attr("cx")).attr("y",+d3.select("#efsa-pesticide-food-"+e).attr("cy")+At/2)}),v.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("index",function(t){return t.index}))}function se(t){for(var e,a,r=0,i=Ae,n=1*t;r<i;++r)e=ke[r],a=_e[e.cluster],e.vx-=(e.x-a.x)*n,e.vy-=(e.y-a.y)*n}function oe(){if(!c&&Q)for(var t=0;t<Ae;t++)ke[t].fx=+Q[t].cx,ke[t].fy=+Q[t].cy,ke[t].x=+Q[t].cx,ke[t].y=+Q[t].cy;T.attr("opacity",1),T.selectAll(".efsa-pesticide-food").attr("r",0).attr("opacity",1),c&&T.selectAll(".efsa-pesticide-food").attr("r",10);var e=d3.forceCollide().radius(function(t){return t.radius+1}).iterations(mobile||zt?4:10),a=c?.015:.8;Ce=d3.forceSimulation().nodes(ke).force("center",d3.forceCenter()).force("collide",e).force("cluster",se).force("gravity",d3.forceManyBody().strength(-20)).force("x",d3.forceX().strength(1)).force("y",d3.forceY().strength(1)).alphaDecay(a).on("tick",ce).on("end",function(){for(var t=0,e=Ae;t<e;t++){var a=ke[t];qe.push({x:a.x,y:a.y,radius:a.radius})}var r=0,i="food"===s?2*l:3*l,n="food"===s?l/5:l/25;T.selectAll(".efsa-pesticide-food").transition().ease(q.qeaseElastic).duration(i).delay(function(t,e){return r++,200+e%20*n}).attr("r",function(){return d3.select(this).attr("r-val")}).on("end",function(){0===--r&&de()}),c&&(console.info("SAVING"),function(){var t=[];T.selectAll("circle").each(function(e){var a=d3.select(this).attr("index"),r=d3.select(this).attr("cx"),i=d3.select(this).attr("cy");t[a]={cx:r,cy:i}});var e={};e.width=H,e.height=j,e.data=t,d3.request("saveForced.php").header("X-Requested-With","XMLHttpRequest").header("Content-Type","application/x-www-form-urlencoded").post("type="+s+"&data="+JSON.stringify(e),function(){})}()),"country"===s&&setTimeout(function(){for(var t=0;t<Ae;t++)ke[t].fx=null,ke[t].fy=null;Ce.nodes(ke).alphaTarget(.007).alphaDecay(.8).restart(),setTimeout(function(){qe=[];for(var t=0,e=Ae;t<e;t++){var a=ke[t];qe.push({x:a.x,y:a.y,radius:a.radius})}},2e3)},100)})}function le(){var t=mobile?3:7;E.append("text").attr("class","efsa-pesticide-expanded-circle-text").attr("id","efsa-pesticide-expanded-circle-text-1").attr("fill",d).attr("x",10).attr("y",-ht/2.5).text(h.global.below_loq).style("font-size",1.1*qt+"px"),E.append("text").attr("class","efsa-pesticide-expanded-circle-text efsa-pesticide-expanded-circle-text-value").attr("fill",d).attr("x",10).attr("y",-ht/2.5+30).text("0.00%").style("font-size",1.5*qt+"px"),E.append("text").attr("class","efsa-pesticide-expanded-circle-text").attr("id","efsa-pesticide-expanded-circle-text-2").attr("fill",p).attr("x",10).attr("y",0).text(h.global.between_loq_and_mrl).style("font-size",1.1*qt+"px"),E.append("text").attr("class","efsa-pesticide-expanded-circle-text efsa-pesticide-expanded-circle-text-value").attr("fill",p).attr("x",10).attr("y",30).text("0.00%").style("font-size",1.5*qt+"px"),E.append("text").attr("class","efsa-pesticide-expanded-circle-text").attr("id","efsa-pesticide-expanded-circle-text-3").attr("fill",f).attr("x",10).attr("y",ht/2.5).text(h.global.above_mrl).style("font-size",1.1*qt+"px"),E.append("text").attr("class","efsa-pesticide-expanded-circle-text efsa-pesticide-expanded-circle-text-value").attr("fill",f).attr("x",10).attr("y",ht/2.5+30).text("0.00%").style("font-size",1.5*qt+"px"),E.append("circle").attr("class","efsa-pesticide-expanded-circle-text").attr("id","efsa-pesticide-expanded-circle-text-1c").attr("cx",-ht/2+50).attr("cy",-ht/2.5-7).attr("r",t).attr("fill",d),E.append("circle").attr("class","efsa-pesticide-expanded-circle-text").attr("id","efsa-pesticide-expanded-circle-text-2c").attr("cx",-ht/2+5).attr("cy",-7).attr("r",t).attr("fill",p),E.append("circle").attr("class","efsa-pesticide-expanded-circle-text").attr("id","efsa-pesticide-expanded-circle-text-3c").attr("cx",-ht/2+50).attr("cy",ht/2.5-7).attr("r",t).attr("fill",f);var e,a=mobile?4:5;if(zt||Tt||Ct)for(r=1;r<=3;r++)e=d3.select("#efsa-pesticide-expanded-circle-text-"+r).text().length,d3.select("#efsa-pesticide-expanded-circle-text-"+r+"c").attr("cx",-e*a);else for(var r=1;r<=3;r++)e=d3.select("#efsa-pesticide-expanded-circle-text-"+r)._groups[0][0].getBBox().width,d3.select("#efsa-pesticide-expanded-circle-text-"+r+"c").attr("cx",-e/2-5)}function de(){c&&console.info("START"),L.selectAll(".efsa-pesticide-tab").transition().duration(l/2).delay(function(t,e){return e*(l/6)}).attr("transform","translate(0,0)"),ut=!0,d3.select("#efsa-pesticide-loading").transition().duration(2*l).style("background-color","rgba(255,255,255,0)").on("end",function(){Et(d3.select("#efsa-pesticide-loading"))}),function(){d3.selectAll(".efsa-pesticide-tab").on("click",St),mobile?(v.on("click",function(t,e){if(q.d3stopPropagation(),!et&&ut){var a=+new Date;if(!(a-dt<l))if(dt=a,-1!==it&&it===t.index||"food"!==s)if("food"===s){Ut(0,0,!1);var r=t.color,i=t.category,n=t.subcategory,c=+t.value_below_loq,o=+t.value_below_mrl,d=+t.value_above_mrl,p=t.food,f=+t.samples;Vt(r,i,n,p,f,c,o,d,I),setTimeout(function(){fe(function(){})},l)}else"country"===s&&(Ut(0,0,!1),Wt(),Vt(x,"countries",t.subcategory,t.food,[t.samples,t.inhabitants],50,20,30,I));else-1===it?Ft(t,e):(Ut(0,0,!1),setTimeout(function(){Ft(t,e)},l))}}),d3.selectAll(".efsa-pesticide-subtab").on("click",function(t){et||(V(),Mt(g),ve(t,d3.select(this).attr("fill")))}),d3.selectAll(".efsa-pesticide-tab-title").on("click",function(t,e){q.d3stopPropagation(),t?(St(t),ge(t,d3.select(this).attr("fill"))):ie()})):(v.on("mouseover",function(t,e){if(!ct&&!(it>-1)&&!nt&&!et&&ut){var a="food"===s?d3.select(this).attr("fill-val"):"gray";if(1===+d3.select(this).attr("opacity")){var r=t.food;r="food"===s?h.foods[r]:h.countries[r],Xt(+d3.select(this).attr("cx")+H/2-t.radius/3,+d3.select(this).attr("cy")+j/2-t.radius/3,r,a,d3.select(this).attr("index"))}}}),v.on("mousemove",function(t,e){ct||it>-1||nt||et||!ut||rt>-1||function(t,e){rt=e;for(var a=0;a<Ae;a++)a!==e&&(ke[a].fx=null,ke[a].fy=null);ke[e].radius=qe[e].radius+.3*qe[e].radius,d3.select("#efsa-pesticide-food-"+e).transition().duration(2*l).ease(q.qeaseElastic).attr("r",ke[e].radius),Ce.nodes(ke).alphaTarget(.002).alphaDecay(.8).restart()}(0,e)}),v.on("mouseout",function(t,e){Yt(d3.select(this).attr("index")),nt||et||!ut||ct||(-1===it?ye(t,e):(Ut(0,0,!0),setTimeout(function(){ye(t,e)},.7*l)))}),v.on("click",function(t,e){if(q.d3stopPropagation(),"country"===s&&ye(t,e),Yt(-999),!(ct||at||et)&&ut){var a=+new Date;if(!(a-dt<l))if(dt=a,-1!==it||"food"!==s)if("food"===s){Ut(0,0,!1);var r=t.color,i=t.category,n=t.subcategory,c=+t.value_below_loq,o=+t.value_below_mrl,d=+t.value_above_mrl,p=t.food,f=+t.samples;Vt(r,i,n,p,f,c,o,d,I),setTimeout(function(){fe(function(){})},l)}else"country"===s&&(Ut(0,0,!1),Wt(),Vt(x,"countries",t.subcategory,t.food,[t.samples,t.inhabitants],50,20,30,I));else Ft(t,e)}}),g.on("mouseout",function(){ct||ie()}),d3.selectAll(".efsa-pesticide-subtab").on("mouseover",V),d3.selectAll(".efsa-pesticide-subtab").on("mouseout",R),d3.selectAll(".efsa-pesticide-subtab").on("click",function(t){et||(Mt(g),ve(t,d3.select(this).attr("fill")))}),d3.selectAll(".efsa-pesticide-tab-title").on("mouseover",function(t,a){t&&o(e[a])}),d3.selectAll(".efsa-pesticide-tab-title").on("mouseout",function(t,e){et||at||v.style("cursor","pointer").transition().duration(l).attr("opacity",1)}),d3.selectAll(".efsa-pesticide-tab-title").on("click",function(t){q.d3stopPropagation(),t?(St(t),ge(t,d3.select(this).attr("fill"))):ie()}));"country"===s&&d3.selectAll(".efsa-pesticide-expanded-circle-rect").on("click",function(t,e){if(q.d3stopPropagation(),Yt(-1),0===e)st&&he();else if(1===e){if(!st){P.select("#efsa-pesticide-expanded-circle-rect-close-map-marker").remove(),Et(F),Et(U),Mt(E),Mt(M),re(Bt[pt].value_below_loq,Bt[pt].value_below_mrl,Bt[pt].value_above_mrl);(c=d3.select("#efsa-pesticide-expanded-circle-rect-1")).style("cursor","default"),c.transition().duration(l).attr("transform",function(t){return"translate("+-c.attr("width")+",0)"}).on("end",function(){Mt(d3.select("#efsa-pesticide-expanded-circle-rect-0")),Mt(d3.select("#efsa-pesticide-expanded-circle-rect-text-0"))}),d3.select("#efsa-pesticide-expanded-circle-rect-text-1").transition().duration(l).attr("transform",function(t){return"translate("+(-2*c.attr("width")+d3.select(this)._groups[0][0].getBBox().width+15+G)+",0)"}),d3.select("#efsa-pesticide-expanded-circle-rect-icon-pie-chart").transition().duration(l).attr("transform",function(t){return"translate("+(-2*c.attr("width")+d3.select("#efsa-pesticide-expanded-circle-rect-text-1")._groups[0][0].getBBox().width+15+G)+",0)"}),(c=d3.select("#efsa-pesticide-expanded-circle-rect-2")).style("cursor","pointer"),c.transition().duration(l).attr("transform","translate(0,0)"),d3.select("#efsa-pesticide-expanded-circle-rect-text-2").transition().duration(l).attr("transform","translate(0,0)"),d3.select("#efsa-pesticide-expanded-circle-rect-icon-map-marker").transition().duration(l).attr("transform","translate(0,0)").on("end",function(){P.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart").remove(),P.append("rect").attr("id","efsa-pesticide-expanded-circle-rect-close-pie-chart").attr("x",-d3.select("#efsa-pesticide-expanded-circle-rect-1").attr("width")-G-2).attr("y",ht/10-ht+G+5).attr("width",G).attr("height",G).attr("fill","#a8a8a8").attr("cursor","pointer").on("click",function(){var t=d3.select("#efsa-pesticide-expanded-circle-rect-1");t.transition().duration(l).attr("transform","translate(0,0)"),t.style("cursor","pointer"),d3.select("#efsa-pesticide-expanded-circle-rect-text-1").transition().duration(l).attr("transform","translate(0,0)"),d3.select("#efsa-pesticide-expanded-circle-rect-icon-pie-chart").transition().duration(l).attr("transform","translate(0,0)"),M.selectAll("*").remove(),Et(E),Et(M),Mt(F),P.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart").remove(),P.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart-text").remove()}).on("mouseover",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart-text").style("text-decoration","underline")}).on("mouseout",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart-text").style("text-decoration","none")}),P.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart-text").remove(),P.select("#efsa-pesticide-expanded-circle-rect-close-map-marker-text").remove(),P.append("text").attr("id","efsa-pesticide-expanded-circle-rect-close-pie-chart-text").attr("x",-d3.select("#efsa-pesticide-expanded-circle-rect-1").attr("width")-G-2+G/2).attr("y",ht/10-ht+G+5+G/2+At/2.5).attr("text-anchor","middle").attr("fill","white").style("font-size",1.25*qt+"px").text("x")})}}else if(2===e&&!st){P.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart").remove(),Et(F),Et(E),Et(M),Mt(U);var a=i.composition[pt],r={Domestic:0,EU:0,TC:0,UN:0};for(var n in a)r[a[n].type]+=+a[n].samples;Gt(r.Domestic,r.EU,r.TC,r.UN,pt),setTimeout(function(){d3.select(".efsa-pesticide-expanded-circle-pie").append("rect").attr("x",-ht/3).attr("width",ht/1.5).attr("y",-qt).attr("height",2*qt).attr("id","efsa-pesticide-expanded-circle-pie-tooltip").attr("stroke","white").attr("display","none").attr("pointer-events","none"),d3.select(".efsa-pesticide-expanded-circle-pie").append("text").attr("text-anchor","middle").attr("y",At/2).attr("font-size",At).attr("id","efsa-pesticide-expanded-circle-pie-tooltip-text").attr("fill","white").attr("display","none")},3*l);var c;(c=d3.select("#efsa-pesticide-expanded-circle-rect-2")).style("cursor","default"),c.transition().duration(l).attr("transform",function(t){return"translate("+-c.attr("width")+",0)"}).on("end",function(){Mt(d3.select("#efsa-pesticide-expanded-circle-rect-0")),Mt(d3.select("#efsa-pesticide-expanded-circle-rect-text-0"))}),d3.select("#efsa-pesticide-expanded-circle-rect-text-2").transition().duration(l).attr("transform",function(t){return"translate("+(-2*c.attr("width")+d3.select(this)._groups[0][0].getBBox().width+15+G)+",0)"}),d3.select("#efsa-pesticide-expanded-circle-rect-icon-map-marker").transition().duration(l).attr("transform",function(t){return"translate("+(-2*c.attr("width")+d3.select("#efsa-pesticide-expanded-circle-rect-text-2")._groups[0][0].getBBox().width+15+G)+",0)"}),(c=d3.select("#efsa-pesticide-expanded-circle-rect-1")).style("cursor","pointer"),c.transition().duration(l).attr("transform","translate(0,0)"),d3.select("#efsa-pesticide-expanded-circle-rect-text-1").transition().duration(l).attr("transform","translate(0,0)"),d3.select("#efsa-pesticide-expanded-circle-rect-icon-pie-chart").transition().duration(l).attr("transform","translate(0,0)").on("end",function(){P.select("#efsa-pesticide-expanded-circle-rect-close-map-marker").remove(),P.append("rect").attr("id","efsa-pesticide-expanded-circle-rect-close-map-marker").attr("x",-d3.select("#efsa-pesticide-expanded-circle-rect-2").attr("width")-G-2).attr("y",ht/10-ht+2*(G+5)).attr("width",G).attr("height",G).attr("fill","#a8a8a8").attr("cursor","pointer").on("click",function(){var t=d3.select("#efsa-pesticide-expanded-circle-rect-2");t.transition().duration(l).attr("transform","translate(0,0)"),t.style("cursor","pointer"),d3.select("#efsa-pesticide-expanded-circle-rect-text-2").transition().duration(l).attr("transform","translate(0,0)"),d3.select("#efsa-pesticide-expanded-circle-rect-icon-map-marker").transition().duration(l).attr("transform","translate(0,0)"),M.selectAll("*").remove(),Et(U),Mt(F),P.select("#efsa-pesticide-expanded-circle-rect-close-map-marker").remove(),P.select("#efsa-pesticide-expanded-circle-rect-close-map-marker-text").remove()}).on("mouseover",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-map-marker-text").style("text-decoration","underline")}).on("mouseout",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-map-marker-text").style("text-decoration","none")}),P.select("#efsa-pesticide-expanded-circle-rect-close-map-marker-text").remove(),P.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart-text").remove(),P.append("text").attr("id","efsa-pesticide-expanded-circle-rect-close-map-marker-text").attr("x",-d3.select("#efsa-pesticide-expanded-circle-rect-2").attr("width")-G-2+G/2).attr("y",ht/10-ht+2*(G+5)+G/2+At/2.5).attr("text-anchor","middle").attr("fill","white").style("font-size",1.25*qt+"px").text("x")})}});P.on("click",function(){q.d3stopPropagation()}),g.on("click",function(){q.d3stopPropagation()}),"food"===s&&d3.select("#efsa-pesticide-expanded-circle-rect-2").on("click",function(){if(ft===N){t=pt;ne(),Ut(0,0,!1),setTimeout(function(){o(t)},3*l)}else{var t=pt;ne(),Ut(0,0,!1),setTimeout(function(){V(t)},3*l)}ie()});Z.on("click",ie)}()}function pe(t){if(et=!0,P.attr("transform","translate("+H/2+","+j/2+")"),at=!1,t){var e=0;T.selectAll(".efsa-pesticide-food").transition().duration(l).ease(q.qeaseElastic).delay(function(t,a){e++;var r=H/5-+d3.select(this).attr("cx")/2;return r<0&&(r=0),r}).attr("transform","translate(0,0)").on("end",function(){--e?et=!0:(et=!1,at=!1)})}else et=!1,T.attr("transform","translate("+H/2+","+j/2+")"),T.selectAll(".efsa-pesticide-food").attr("transform","translate(0,0)")}function fe(t){if(!mobile){et=!0;var e=0;T.selectAll(".efsa-pesticide-food").transition().ease(q.qeaseElastic).duration(l).delay(function(t,a){e++;var r=H/4+ +d3.select(this).attr("cx")/2;return r<0&&(r=0),r}).attr("transform","translate(+"+H/5+", 0)").on("end",function(){--e?et=!0:(et=!1,at=!0,t())})}}function ue(t,e,a,r,i,n,c,s){mobile&&(i=0);var o=2*q.pi,l=d3.arc().innerRadius(n).outerRadius(c).startAngle(e*o);t.append("path").datum({endAngle:e*o}).attr("fill",r).attr("d",l).transition().duration(i).ease(d3.easeLinear).attrTween("d",function(t){return function(e){var a=d3.interpolate(e.endAngle,t);return function(t){return e.endAngle=a(t),l(e)}}}(a*o)).on("end",s)}function xe(t){M.text(""),M.html(""),t?setTimeout(function(){Et(P)},1.2*l):Et(P),"food"===s?Et(E):"country"===s&&Et(F),Et(d3.selectAll(".efsa-pesticide-expanded-circle-rect")),Et(d3.selectAll(".efsa-pesticide-expanded-circle-rect-text")),me()}function me(){d3.select("#efsa-pesticide-expanded-circle-rect-icon-sub-category").style("display","none"),Et(d3.select("#efsa-pesticide-expanded-circle-rect-icon-pie-chart")),Et(d3.select("#efsa-pesticide-expanded-circle-rect-icon-map-marker")),P.select("#efsa-pesticide-expanded-circle-rect-close-all").remove(),P.select("#efsa-pesticide-expanded-circle-rect-close-all-text").remove(),P.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart").remove(),P.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart-text").remove(),P.select("#efsa-pesticide-expanded-circle-rect-close-map-marker").remove(),P.select("#efsa-pesticide-expanded-circle-rect-close-map-marker-text").remove()}function ye(t,e){rt=-1;for(var a=0;a<Ae;a++)a!==e&&(ke[a].fx=null,ke[a].fy=null);ke[e].radius=qe[e].radius,d3.select("#efsa-pesticide-food-"+e).transition().duration(2*l).ease(q.qeaseElastic).attr("r",ke[e].radius),Ce.nodes(ke).alphaTarget(mobile?.003:.001).alphaDecay(.8).restart()}function he(){M.selectAll("*").remove(),Et(F),Et(U),Et(E),C.transition().duration(l).style("opacity","0").on("end",function(){C.selectAll("*").remove(),Mt(T),ie(),st=!1}),d3.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut").remove(),d3.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut-text").remove()}function ve(t,e){q.d3stopPropagation();var n=i["subcat-"+t],c=t,s="";for(var o in a)if(a[o].indexOf(c)>-1){s=o;break}var l=0,d=0,p=0,f=0;_.each(r,function(e){e.subcategory===t&&(l+=+e.value_below_loq_as_samples,d+=+e.value_below_mrl_as_samples,p+=+e.value_above_mrl_as_samples,f++)}),Vt(e,s,c,c,n,l*=100/n,d*=100/n,p*=100/n,S)}function ge(t,e){q.d3stopPropagation();var a=i["cat-"+t],n=t,c=0,s=0,o=0,l=0;_.each(r,function(e){e.category===t&&(c+=+e.value_below_loq_as_samples,s+=+e.value_below_mrl_as_samples,o+=+e.value_above_mrl_as_samples,l++)}),Vt(e,n,"",n,a,c*=100/a,s*=100/a,o*=100/a,N)}var be=0;_.each(r,function(t,e){be=Math.max(be,t.value)}),yt="food"===s?90:110,vt="food"===s?6:1,Z.selectAll("*").remove(),T=Z.append("g").attr("opacity","0"),C=Z.append("g").style("display","none"),P=Z.append("g").style("display","none"),L=Z.append("g"),B=Z.append("g"),O=Z.append("g"),D=P.append("g"),M=P.append("g"),E=P.append("g").style("display","none"),U=P.append("g").style("display","none"),F=P.append("g").style("display","none"),pe(!1),_.each(e,function(t,e){u[t]=u[e]});var we=function(t){return u[t]},_e=new Array(vt),ke=[],qe=[],Ae=0;_.each(r,function(t,a){var r,i=be;if("food"===s)r=10+40/i*t.value;else{var n=1e3+3e4/i*t.value;r=Math.sqrt(n/Math.PI)}var c=e.indexOf(t.category),o=0,l=0;Q&&(o=Q[a].x,l=Q[a].y);var d={cluster:c,radius:r,inhabitants:+t.inhabitants,samples:+t.value,value:+t.value,value_below_loq:t.value_below_loq,value_below_mrl:t.value_below_mrl,value_above_mrl:t.value_above_mrl,countrycode:t.countrycode,food:t.name,subcategory:t.subcategory,category:t.category,color:"food"===s?u[c]:x,x:o,y:l};ke.push(d),Ae++,(!_e[c]||r>_e[c].radius)&&(_e[c]=d)}),ct=!1,pt=null,ft=null,at=!1,tt=null;var ze=0,Te=-1;jt();var Ce;c?(oe(),T.attr("opacity","1"),setTimeout(de,15e3)):d3.text(s+"-nodes.dat",function(t,e){if(t)throw t;var a=JSON.parse(e);Q=a.data,oe()})}function n(t){return""===t[0]?t=t.replace("","O"):""===t[0]&&(t=t.replace("","A")),""===t[1]?t=t.replace("","e"):""===t[1]&&(t=t.replace("","u")),t}var c=!1,s=["en","it","fr","de"],o=function(){var t=window.location.search;if(t&&(t=t.split("?")).length&&(t=t[1])){t=t.split("&");for(var e in t){var a=t[e].split("=");if("lang"===a[0])return a[1]}}var r=window.location.href;for(var e in s){var i=s[e];if(r.indexOf("/"+i+"/")>0)return i}return null}()||t.lang||navigator.language&&navigator.language.split("-")[0]||"en";s.indexOf(o)<0&&(o="en"),window.efsaPesticideDatavizLang=o;var l=t.time||(mobile?200:320),d=t.donut.color_1||"#30807c",p=t.donut.color_2||"#4cbf85",f=t.donut.color_3||"#c34a2d",u=t.colors||["#00aac0","#7baa52","#f27f89","#e8b469","#8e3392","#98935c","#7a7c7f"],x=t.gray||"#a8a8a8",m="#00626d",y="white",h=i18n(o);q.fastclick();var v,g,b,w,k,A,z,T,C,P,L,B,O,D,M,E,U,F,R=q.speedtest(),W=q.ceil(R/10),N=1,S=2,I=3,Q=null,Z=d3.select("#efsa-pesticide-dataviz-svg"),H=Z.node().clientWidth||parseInt(window.getComputedStyle(Z.node()).width),j=Z.node().clientHeight||parseInt(window.getComputedStyle(Z.node()).height);Z.attr("viewBox","0 0 "+H+" "+j),Z.selectAll("*").remove();var X,Y=q.round(H/18.776),J=0,V=31,G=q.round(j/V),K=mobile?1:2,$=q.round(H/4.8),tt=null,et=!1,at=!1,rt=-1,it=-1,nt=!1,ct=!1,st=!1,ot=!1,lt=!1,dt=0,pt=-1,ft=null,ut=!1,xt=j/3.85-G,mt=.15,yt=null,ht=j/3.75;H>1500&&(ht+=20);var vt=null,gt=.25,bt="#a0a0a0",wt=!1,_t=0,kt=["Domestic","EU","TC","UN"],qt=Math.min(q.round(j/45),q.round(H/70));qt<6&&(qt=6);var At=q.round(.8*qt);qt>16.5&&(qt=16.5),At>13&&(At=13);var zt=navigator.userAgent.indexOf("Trident")>-1,Tt=navigator.userAgent.indexOf("Firefox")>-1,Ct=navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")<0,Pt=q.getDecimalSeparator(o),Lt="."===Pt?",":".",Bt=[],Ot=[],Dt=[];window.doFoods=function(){a()},window.doCountries=function(){r()};var Mt=[function(){},a,r];window.location.search.indexOf("do=foods")>-1?Mt[1]():window.location.search.indexOf("do=countries")>-1?Mt[2]():Mt[1]()}var efsaPesticideDatavizConfig={colors:["#31b7d2","#71c17c","#e7799e","#f8c25e","#8a428c","#acc25d","#7a7c7f"],donut:{color_1:"#00a690",color_2:"#4cc4a9",color_3:"#de4a7a"},gray:"#a8a8a8",all_foods:"#85746c"},mobile=q.mobilecheck(),RESIZE_TOLERANCE=70;efsaPesticideDataviz(efsaPesticideDatavizConfig);var resize_w=window.innerWidth,resize_h=window.innerHeight;window.addEventListener("resize",function(){if(mobile){var t=window.innerWidth;if(t-resize_w)return resize_w=t,void efsaPesticideDataviz(efsaPesticideDatavizConfig);var e=window.innerHeight,a=e-resize_h;return Math.abs(a)>RESIZE_TOLERANCE?(resize_w=t,resize_h=e,d3.select("#efsa-pesticide-dataviz-svg").attr("viewBox",[0,0,resize_w,resize_h].join(" ")),void efsaPesticideDataviz(efsaPesticideDatavizConfig)):void setTimeout(function(){var t=window.innerHeight,e=t-resize_h,a=t/resize_w,r=d3.select("#efsa-pesticide-dataviz-svg").attr("viewBox").split(" ");-e/a>=0&&(r[0]=-e/a,r[2]=resize_w+e/a,d3.select("#efsa-pesticide-dataviz-svg").attr("viewBox",r.join(" ")))},500)}return void efsaPesticideDataviz(efsaPesticideDatavizConfig)});
"use strict";function efsaPesticideDataviz(t){function e(t,e){d3.request(t).mimeType("text/plain").response(function(t){return d3.dsvFormat(";").parse(t.responseText)}).get(function(t){e(t)})}function a(t){e("/sites/default/files/interactive_tools/pesticidesresidues_2016/data/food.csv",t)}function r(t){e("/sites/default/files/interactive_tools/pesticidesresidues_2016/data/results-by-country.csv",function(a){for(var r in a){var i=a[r];i.name&&(Ne[i.name]={value_below_loq:+i["%below LOQ"],value_below_mrl:+i["%betweenLOQ_MRL"],value_above_mrl:+i["%aboveLOQ"]})}e("/sites/default/files/interactive_tools/pesticidesresidues_2016/data/results-by-origin.csv",function(a){for(var r in a){var i=a[r];i.name&&(Re[i.name]={value_below_loq:+i["%belowLOQ"],value_below_mrl:+i["%betweenLOQ_MRL"],value_above_mrl:+i["%aboveLOQ"]})}e("/sites/default/files/interactive_tools/pesticidesresidues_2016/data/country.csv",t)})})}function i(){ne=q.round(te/ie),G=null,d3.select("#efsa-pesticide-loading").style("display","block").style("background-color","rgba(245,245,245,.5)"),a(function(t){var e=[],a=[],r=[],i={},n=0;_.each(t,function(t){var c=t.Category,s=t.SubCategory,o=+t.Samples;e.push({name:c,subcategory:null}),a[c]=a[c]?a[c]:[],a[c].indexOf(s)<0?a[c].push(s):null,i["cat-"+c]=i["cat-"+c]?i["cat-"+c]:0,i["subcat-"+s]=i["subcat-"+s]?i["subcat-"+s]:0,i["cat-"+c]+=o,i["subcat-"+s]+=o,r.push({name:t.Food,subcategory:s,category:c,value:o,value_below_loq_as_samples:t["Below LOQ"],value_below_mrl_as_samples:t["Below MRL"],value_above_mrl_as_samples:t["Above MRL"],value_below_loq:t["% Below LOQ"],value_below_mrl:t["% Below MRL"],value_above_mrl:t["% Above MRL"]}),s.length>n&&(n=s.length)}),se=n*Me/1.7,se=Math.max(re+30,se),e=_.uniq(_.map(e,function(t){return t.name})),s(e,a,r,i,"food")})}function n(){G=null,ne=q.round(te/ie),ne*=1.3,d3.select("#efsa-pesticide-loading").style("display","block").style("background-color","rgba(245,245,245,.5)"),r(function(t){var e=[],a=[],r=[],i={},n=[],c={};_.each(t,function(t){var e=t.country;n[e]||(n[e]={name:e,countrycode:t.code,inhabitants:t.inhabitants,samples:0}),n[e].samples+=+t.samples,c[t.country]=c[t.country]?c[t.country]:[],c[t.country].push({country:t.refcountry,type:t.type,samples:+t.samples})}),e=["countries"],a.countries=[];var o=0;for(var l in n){var d=n[l],p=d.name,f=+d.samples;a.countries.push(p),r.push({name:p,countrycode:d.countrycode,subcategory:p,category:"countries",value:f,value_below_loq:Ne[p].value_below_loq,value_below_mrl:Ne[p].value_below_mrl,value_above_mrl:Ne[p].value_above_mrl,samples:f,inhabitants:+d.inhabitants}),p.length>o&&(o=p.length),i["cat-countries"]=i["cat-countries"]?i["cat-countries"]:0,i["subcat-"+p]=i["subcat-"+p]?i["subcat-"+p]:0,i["cat-countries"]+=f,i["subcat-"+p]+=f,i["subcat-"+p+"-inhabitants"]=+d.inhabitants}se=o*Me/2+30,se=Math.max(re+30,se),i.composition=c,s(e,a,r,i,"country")})}function c(){K.selectAll("*").remove(),E=K.append("g").attr("opacity","0"),U=K.append("g").style("display","none"),F=K.append("g").style("display","none"),W=K.append("g"),N=K.append("g"),R=K.append("g"),S=F.append("g"),I=F.append("g"),Q=F.append("g").style("display","none"),Z=F.append("g").style("display","none"),H=F.append("g").style("display","none")}function s(t,e,a,r,i){function n(t){q.d3stopPropagation(),le||xe||(p&&d3.selectAll(".efsa-pesticide-subtab").transition().duration(h/5).attr("fill",function(t,e){return d3.select(this).attr(e===ge?"fill-default":"fill-brighter")}),we=!1,E.attr("opacity","1"),2>Y&&!p?(C.style("cursor",function(e){return e.category===t?"pointer":"default"}).transition().duration(h).attr("opacity",function(e){return e.category===t?1:ke}),setTimeout(function(){we=!0},h)):(C.attr("opacity",function(e){return e.category===t?1:ke}).style("cursor",function(e){return e.category===t?"pointer":"default"}),we=!0))}function s(t){ge!==t&&d3.select(this).transition().duration(h/5).attr("fill",d3.select(this).attr("fill-brighter"))}function l(t){q.d3stopPropagation(),le||(this&&this!==window&&(p&&d3.selectAll(".efsa-pesticide-subtab").transition().duration(h/5).attr("fill",function(t,e){return d3.select(this).attr(e===ge?"fill-default":"fill-brighter")}),d3.select(this).transition().duration(h/5).attr("fill",d3.select(this).attr("fill-default"))),xe||(we=!1,E.attr("opacity","1"),2>Y&&!p?(C.style("cursor",function(e){return e.subcategory===t?"pointer":"default"}).transition().duration(h/3).attr("opacity",function(e){return e.subcategory===t?1:ke}),setTimeout(function(){we=!0},h)):(C.attr("opacity",function(e){return e.subcategory===t?1:ke}).style("cursor",function(e){return e.subcategory===t?"pointer":"default"}),we=!0)))}function d(){C.attr("opacity","1"),E.attr("opacity","1")}function x(t){t.style("display","block")}function y(t){t.style("display","none")}function m(t,e,a){if(q.d3stopPropagation(),ee=null,Va&&0!==Va.length&&-1!==fe){ue=!0,fe=-1;var r=C;r.attr("stroke-width",0).attr("fill",function(){return d3.select(this).attr("fill-val")}),"country"===i&&r.attr("stroke-width",ze).attr("stroke",Ce);var n=0;r.transition().duration(.7*h).ease(q.qeaseElastic).attr("cx",function(t,e){return n++,Va[e].x}).attr("cy",function(t,e){return Va[e].y}).attr("r",function(){return d3.select(this).attr("r-val")}).on("end",function(){if(n--,!n){for(var t=0;Ga>t;t++){var e=Va[t];Ja[t].radius=e.radius,Ja[t].fx=e.x,Ja[t].fy=e.y,Ja[t].x=Ja[t].fx,Ja[t].y=Ja[t].fy}ue=!1}}),ee=null,Ke(),a&&Ge(!1)}}function X(t,e){if(q.d3stopPropagation(),Va&&0!==Va.length&&we&&!le&&!de&&(xe&&ba(),null===oe||oe===t.cluster)){var a=d3.select("#efsa-pesticide-food-"+e).attr("opacity");"1"===a&&(ee=t.index,ue?setTimeout(function(){ie(t,e)},.7*h):ie(t,e))}}function ie(t,e){if(t.index===ee){"food"!==i&&(y(Q),y(I),y(Z)),fe=t.index;for(var a=0;Ga>a;a++)a!==e?(Ja[a].fx=null,Ja[a].fy=null):(Ja[a].fx=Va[e].x,Ja[a].fy=Va[e].y);Ja[e].radius=qe,tr.nodes(Ja).alphaTarget(p?.003:.002).alphaDecay(.8).restart();var r=d3.select("#efsa-pesticide-food-"+e),n=t.color;r.attr("stroke-width",qe/10).attr("stroke",n).attr("fill","white"),r.transition().ease(q.qeaseElastic).duration(h).attr("r",qe-qe/10),Da(!1),Se();var c=t.food,s=t.samples;q.d3attr(L,{subcategory:t.subcategory,category:t.category,value_below_loq:t.value_below_loq,value_below_mrl:t.value_below_mrl,value_above_mrl:t.value_above_mrl,samples:s,name:c});var o={x:+Va[e].x,y:+Va[e].y};Ze(o.x,o.y,n,0);var l="food"===i?h/2:0;setTimeout(function(){t.index===ee&&(Qe(o.x,o.y,n,c),Ie(o.x,o.y,n,s,z.global.samples))},l)}}function Se(){x(F),x(L)}function Ie(t,e,a,r,n){"food"===i?(oa(M,Pe,r,"",0,4,function(){-1===fe&&M.text("")}),Pe=+r,D.text(n),e+=Oe,q.d3attr(M,{fill:a,x:t,y:e}),q.d3attr(D,{fill:a,x:t,y:e+Oe})):(M.empty(),q.d3attr(M,{fill:a,x:t,y:e}));var c=de?-$/5:0,e=0;1===Ka?e=-Me:2===Ka&&(e=-Me/2),q.d3attr(M,{transform:"translate("+c+","+e+")"}),q.d3attr(D,{transform:"translate("+c+","+e+")"})}function Qe(t,e,a,r){q.d3attr(P,{fill:a,dx:0,dy:"1.1em",x:t,y:e}),"food"===i&&(q.d3attr(B,{fill:a,x:t-47,y:e}),q.d3attr(O,{x:t,y:e+14}),B.style("display","block"),O.style("display","block")),P.text("food"===i?z.foods[r].toUpperCase():z.countries[r].toUpperCase()),"food"===i?P.style("font-size",Me+"px"):P.style("font-size",Oe+"px");var n=He(P,2*(qe-qe/4));Ka=n;var c=-P._groups[0][0].getBBox().height;"country"===i?c/=2:c-=n>2?Me/2:n>1?Me:2*Me;var s=de?-$/5:0;return q.d3attr(P,{transform:"translate("+s+","+c+")"}),"food"===i&&(q.d3attr(B,{transform:"translate("+s+","+(qe-qe/1.8)+")"}),q.d3attr(O,{transform:"translate("+s+","+(qe-qe/1.8)+")"})),c}function Ze(t,e,a,r){x(L),q.d3attr(L,{stroke:a,"stroke-width":0,fill:"white",cx:t,cy:e,r:r});var i=de?-$/5:0;q.d3attr(L,{transform:"translate("+i+",0)"})}function He(t,e){var a=1;return t.each(function(){for(var t,r=d3.select(this),i=r.text().split(/\s+/).reverse(),n=[],c=0,s=1,o=r.attr("x"),l=r.attr("y"),d=parseFloat(r.attr("dy")),p=r.text(null).append("tspan").attr("x",o).attr("y",l).attr("dy",d+"em"),t=i.pop();t;)n.push(t),p.text(n.join(" ")),p.node().getComputedTextLength()>e&&(n.pop(),p.text(n.join(" ")),n=[t],p=r.append("tspan").attr("x",o).attr("y",l).attr("dy",++c*s+d+"em").text(t),a++),t=i.pop()}),a}function Xe(t){"food"===i&&(W.selectAll(".efsa-pesticide-tab-title").data(t).enter().append("rect").attr("class","efsa-pesticide-tab-title"),W.selectAll(".efsa-pesticide-tab-title-text").data(t).enter().append("text").style("font-size",(Oe+Me)/2+"px").attr("class","efsa-pesticide-tab-title-text").attr("x",-300).attr("y",function(t,e){return _e+e*(ne+ce)+ne/2+6}).text(function(t){return z.foods[t]}).transition().duration(2*h).ease(q.qeaseElastic).delay(function(t,e){return h+(e+1)*h/2}).attr("x",10),re=0,W.selectAll(".efsa-pesticide-tab-title-text").each(function(){re=q.max(re,d3.select(this).node().getBBox().width)}),se=Math.max(re+30,se),W.selectAll(".efsa-pesticide-tab-title").attr("x",0).attr("y",function(t,e){return _e+e*(ne+ce)}).attr("width",se).attr("height",ne).attr("opacity","1").attr("fill",function(t){return Qa(t)}).attr("fill-default",function(t){return Qa(t)}).attr("transform","translate("+-se+",0)").transition().duration(2*h).delay(function(t,e){return(e+1)*h/2}).attr("transform","translate("+-(se-(re+30))+",0)"),W.append("rect").attr("class","efsa-pesticide-tab-title").attr("x",0).attr("y",function(){return _e+-1*(ne+ce)}).attr("width",se).attr("height",ne).attr("opacity","1").attr("fill","gray").attr("fill-default","gray").attr("transform","translate("+-se+",0)").transition().duration(2*h).delay(function(t,e){return e*h/2}).attr("transform","translate("+-(se-(re+30))+",0)"),W.append("text").style("font-size",(Oe+Me)/2+"px").attr("class","efsa-pesticide-tab-title-text").attr("x",-300).attr("y",function(){return _e+-1*(ne+ce)+ne/2+6}).text(z.global.all_products).transition().duration(2*h).ease(q.qeaseElastic).delay(function(){return h/2+h/2}).attr("x",10))}function Ye(t){d3.select("#efsa-pesticide-subtabs-group-"+t).transition().duration(h/3).attr("transform","translate(0, 0)")}function je(a){var r=Qa(a),i=d3.color(r).brighter(.25),n=[t[a]].concat(e[t[a]]),n=e[t[a]];if(!(n.length<2)){var c=N.append("g");c.attr("id","efsa-pesticide-subtabs-group-"+a).attr("transform","translate("+-se+", 0)"),c.selectAll(".efsa-pesticide-subtab-space-"+a).data(n).enter().append("rect").attr("class","efsa-pesticide-subtab efsa-pesticide-subtab-space-"+a).attr("x",-1).attr("y",function(t,e){return _e+(e+2)*(ne+ce)+a*(ne+ce)-ce-5}).attr("width",se).attr("height",ce+5).attr("fill-default","#f4f4f4").attr("fill-brighter","#f4f4f4").attr("fill","#f4f4f4"),c.selectAll(".efsa-pesticide-subtab-"+a).data(n).enter().append("rect").attr("class","efsa-pesticide-subtab efsa-pesticide-subtab-rect efsa-pesticide-subtab-"+a).attr("x",0).attr("y",function(t,e){return _e+(e+1)*(ne+ce)+a*(ne+ce)}).attr("width",se).attr("height",ne).attr("fill-default",r).attr("fill-brighter",i).attr("fill",i),c.selectAll(".efsa-pesticide-subtab-text-"+a).data(n).enter().append("text").style("font-size",(Oe+Me)/2+"px").attr("class","efsa-pesticide-subtab-text efsa-pesticide-subtab-text-"+a).attr("x",10).attr("y",function(t,e){return _e+(e+1)*(ne+ce)+a*(ne+ce)+ne/2+5}).text(function(t){return z.foods[t]})}}function Je(e){if(!le){q.d3stopPropagation();var a=t.indexOf(e);return null!==oe?oe===a?void 0:void Ve():(Ke(),Ge(!1),Da(!1),$e(a),Oa(function(){n(e)}),void 0)}}function Ve(){null!==oe&&(d3.selectAll(".efsa-pesticide-tab-title").transition().duration(h/2).attr("transform","translate("+-(se-(re+30))+",0)"),d3.select("#efsa-pesticide-subtabs-group-"+oe).transition().duration(h/3).attr("transform","translate("+-se+", 0)"),y(d3.selectAll(".efsa-pesticide-tab-text")),oe=null)}function Ge(t){L.attr("pointer-events","none"),t?L.transition().duration(h).attr("stroke-width",0).attr("r",10).on("end",function(){y(L)}):y(L)}function Ke(){P.text(""),M.text(""),D.text(""),"food"===i&&(B.style("display","none"),O.style("display","none"))}function $e(t){oe=t,Ye(t),we=!1,setTimeout(function(){d3.select(d3.selectAll(".efsa-pesticide-tab-title")._groups[0][t]).transition().duration(h).attr("transform","translate(0, 0)").on("end",function(){setTimeout(function(){we=!0},2*h)})},10)}function ta(){Aa(),setTimeout(function(){Xe(t),_.each(t,function(t,e){je(e)}),ea()},200)}function ea(){R.append("path").attr("id","efsa-pesticide-tooltip").attr("width",0),R.append("text").attr("id","efsa-pesticide-tooltip-text")}function aa(t,e,a,r,i){return"M"+t+" "+e+" L"+t+" "+(e-r-i)+" L"+(t-a)+" "+(e-r-i)+" L"+(t-a)+" "+(e-i)+"L "+(t-i/2)+" "+(e-i)+" Z"}function ra(t,e,a,r,i){$a=i,R.style("display","block"),d3.select("#efsa-pesticide-tooltip-text").text(a);var n=Math.ceil(d3.select("#efsa-pesticide-tooltip-text").node().getBBox().width);d3.select("#efsa-pesticide-tooltip-text").text("");var c=14,s=26,o=50+n;d3.select("#efsa-pesticide-tooltip").attr("d",aa(t,e,o,s,c)).attr("width",o).style("stroke",r),d3.select("#efsa-pesticide-tooltip-text").attr("x",t-o/2).attr("y",e-c-s/3).text(a)}function ia(t){setTimeout(function(){($a===t||-999===t)&&R.style("display","none")},100)}function na(t){d3.selectAll(".efsa-pesticide-expanded-circle-rect-text").attr("x","0"),d3.selectAll(".efsa-pesticide-expanded-circle-rect-text").text(""),d3.selectAll(".efsa-pesticide-expanded-circle-rect-text-for-country").text("");var e=!1;d3.selectAll(".efsa-pesticide-expanded-circle-rect").transition().duration(h).attr("width",0).attr("transform",function(){var t=d3.select(this).attr("x"),e=0;return d3.select(this).attr("transform")&&(e=q.cssTransformTranslateValues(d3.select(this).attr("transform")).y),0>t?"translate("+-t+","+e+")":"translate(0,"+e+")"}).on("end",function(){e||(e=!0,t())})}function ca(t,e,a){d3.selectAll(".efsa-pesticide-expanded-circle-text-for-country").text(function(r,i){if(0===i)return z.countries[t].toUpperCase();if(1===i)return q.numberWithCommas(e,We);if(2===i)return z.global.samples.toUpperCase();if(3===i){var n=e/(a/1e5),c=n.toFixed(1);c=c.replace(",","x"),c=c.replace(".","x");var s=c.split("x")[1];return c=q.numberWithCommas(q.floor(n),We),c=c.replace(",",We),c=c.replace(".",We),c+=Fe+s}return 4===i?z.global.samples_100000.toUpperCase():5===i?z.global.inhabitants.toUpperCase():""}),oa(d3.select(d3.selectAll(".efsa-pesticide-expanded-circle-text-for-country")._groups[0][1]),0,e,"",0,4),oa(d3.select(d3.selectAll(".efsa-pesticide-expanded-circle-text-for-country")._groups[0][3]),0,e/(a/1e5),"",1,4);var r=[];d3.selectAll(".efsa-pesticide-expanded-circle-rect-text").attr("transform","translate(0,0)").style("display",function(t,e){return e>0&&3>e?"block":"none"}).style("font-weight","300").text(function(e,a){if(0===a){if("food"===i)return t.toUpperCase();if("country"===i)return z.countries[t].toUpperCase()}return 1===a?z.global.overall_results:2===a?z.global.origin_of_samples:3===a?"":void 0}).attr("x",0).transition().duration(h).delay(function(t,e){return h+e*h/4}).attr("x",function(t,e){d3.selectAll(".efsa-pesticide-expanded-circle-rect-text").style("display","block");var a=+d3.selectAll(".efsa-pesticide-expanded-circle-rect-text")._groups[0][e].getBBox().width+Ae+Ae/9*e;return"country"===i&&0===e&&(a-=Ae/9),r.push(a),0===e?-a:Ae+Ae/9*e}),d3.selectAll(".efsa-pesticide-expanded-circle-rect").attr("transform","translate(0,0)").style("display",function(t,e){return e>=0&&3>e?"block":"none"}).style("cursor",function(t,e){return e>0&&3>e?"pointer":"default"}).attr("x",function(){return 0}).transition().duration(h).delay(function(t,e){return e*h/4}).attr("x",function(t,e){return 0===e?-r[e]-10:0}).attr("width",function(t,e){return+r[e]+10}).on("end",function(t,e){"country"===i&&0===e&&(F.select("#efsa-pesticide-expanded-circle-rect-close-all").remove(),F.append("rect").attr("id","efsa-pesticide-expanded-circle-rect-close-all").attr("x",-d3.select("#efsa-pesticide-expanded-circle-rect-0").attr("width")-ne-2).attr("y",-Ae+Ae/10).attr("width",ne).attr("height",ne).attr("fill","#a8a8a8").attr("cursor","pointer").on("click",function(){ba()}).on("mouseover",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-all-text").style("text-decoration","underline")}).on("mouseout",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-all-text").style("text-decoration","none")}),F.select("#efsa-pesticide-expanded-circle-rect-close-all-text").remove(),F.append("text").attr("id","efsa-pesticide-expanded-circle-rect-close-all-text").attr("x",-d3.select("#efsa-pesticide-expanded-circle-rect-0").attr("width")-ne-2+ne/2).attr("y",-Ae+Ae/10+ne/2+Me/2.5).attr("text-anchor","middle").attr("fill","white").style("font-size",1.25*Oe+"px").text("x"))}),setTimeout(function(){d3.select("#efsa-pesticide-expanded-circle-rect-icon-pie-chart").attr("transform","translate(0,0)").style("display","block"),d3.select("#efsa-pesticide-expanded-circle-rect-icon-map-marker").attr("transform","translate(0,0)").style("display","block")},2*h)}function sa(t,e,a,r){var n=[],c=d3.select("#efsa-pesticide-expanded-circle-rect-text-1"),s=c.text();C.attr("opacity",ke),d3.selectAll(".efsa-pesticide-expanded-circle-rect-text").style("display","block").attr("text-anchor","end").text(function(a,i){if(0===i)return t;if(1===i)return q.numberWithCommas(e,We)+" "+z.global.samples;if(2===i){if(r===V)return z.global.all_products;if(r===J)return z.global.back_to_subcategory;if(r===j)return z.global.back_to_category}return 3===i?"":void 0}).transition().duration(h).delay(function(t,e){return e*h}).attr("x",function(t,e){var a=d3.selectAll(".efsa-pesticide-expanded-circle-rect-text")._groups[0][e].getBBox().width+Ae+Ae/9*e;return n.push(a),+n[e]}),s=parseInt(s),isNaN(s)&&(s=0),oa(c,s,e," "+z.global.samples,0,4),a&&(a.attr("fill",a.attr("fill-default")),d3.selectAll(".efsa-pesticide-expanded-circle-rect").attr("fill",a.attr("fill-default")),L.attr("stroke",a.attr("fill-default"))),d3.select("#efsa-pesticide-expanded-circle-rect-3").attr("y",a.attr("y")-te/2).attr("x",-($/2-se+2)).attr("fill",a.attr("fill-default")).attr("width",0),d3.selectAll(".efsa-pesticide-expanded-circle-rect").attr("transform","translate(0,0)").style("display","block").style("cursor",function(t,e){return 2===e?"pointer":"default"}).transition().duration(h).delay(function(t,e){return 3===e?0:e*h}).attr("x",function(t,e){return 3===e?-($/2-se+2):0}).attr("width",function(t,e){return 3===e?$/2-(se+ae/2)+2:+n[e]+10}).on("end",function(t,e){"food"===i&&0===e&&(F.select("#efsa-pesticide-expanded-circle-rect-close-food-name").remove(),F.append("rect").attr("id","efsa-pesticide-expanded-circle-rect-close-food-name").attr("x",+d3.select("#efsa-pesticide-expanded-circle-rect-0").attr("width")+2).attr("y",-Ae+Ae/10).attr("width",ne).attr("height",ne).attr("fill",a.attr("fill-default")).attr("cursor","pointer").on("click",function(){ba(),F.select("#efsa-pesticide-expanded-circle-rect-close-food-name").remove(),F.select("#efsa-pesticide-expanded-circle-rect-close-food-name-text").remove()}).on("mouseover",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-food-name-text").style("text-decoration","underline")}).on("mouseout",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-food-name-text").style("text-decoration","none")}),F.select("#efsa-pesticide-expanded-circle-rect-close-food-name-text").remove(),F.append("text").attr("id","efsa-pesticide-expanded-circle-rect-close-food-name-text").attr("x",+d3.select("#efsa-pesticide-expanded-circle-rect-0").attr("width")+2+ne/2).attr("y",-Ae+Ae/10+2+ne/2+Me/2.5).attr("text-anchor","middle").attr("fill","white").style("font-size",1.25*Oe+"px").text("x"))}),r===V?(y(d3.select("#efsa-pesticide-expanded-circle-rect-2")),y(d3.select("#efsa-pesticide-expanded-circle-rect-text-2"))):(x(d3.select("#efsa-pesticide-expanded-circle-rect-2")),x(d3.select("#efsa-pesticide-expanded-circle-rect-text-2"))),setTimeout(function(){r===J?(d3.select("#efsa-pesticide-expanded-circle-rect-icon-sub-category").attr("xlink:href","/sites/default/files/interactive_tools/pesticidesresidues_2016/img/sub-category.png"),d3.select("#efsa-pesticide-expanded-circle-rect-icon-sub-category").style("display","block")):r===j&&(d3.select("#efsa-pesticide-expanded-circle-rect-icon-sub-category").attr("xlink:href","/sites/default/files/interactive_tools/pesticidesresidues_2016/img/category.png"),d3.select("#efsa-pesticide-expanded-circle-rect-icon-sub-category").style("display","block"))},2.5*h)}function oa(t,e,a,r,i,n,c){p&&(n/=2);var s=0,o=setInterval(function(){if(e=q.round((e+a)/2),100>e){var l=e.toFixed(i);l=l.replace(".",Fe),l=l.replace(",",Fe),t.text(l+r)}else t.text(q.numberWithCommas(e.toFixed(i),We)+r);if(s++,s>n){if(clearInterval(o),100>a){var l=a.toFixed(i);l=l.replace(".",Fe),l=l.replace(",",Fe),t.text(l+r)}else t.text(q.numberWithCommas(a.toFixed(i),We)+r);c&&c()}},40)}function la(a,r,n,c,s,o,l,d,f){ia(-1);var u=!xe;xe=!0,L.attr("pointer-events","inherit"),C.style("cursor","default"),q.d3stopPropagation(),q.d3attr(L,{transform:"translate(0,0)"}),L.attr("stroke",a),a&&d3.selectAll(".efsa-pesticide-expanded-circle-rect").attr("fill",a),Ke(),setTimeout(function(){"food"===i?(x(Q),x(I)):"country"===i&&x(H),Ke()},h);var y=t.indexOf(r),m=-1;n&&""!==n&&(m=e[r].indexOf(n)),ge=n||r,be=f,"food"===i&&$e(y),d3.selectAll(".efsa-pesticide-subtab-"+y).attr("transform","translate(0,0)"),d3.selectAll(".efsa-pesticide-subtab-space-"+y).attr("transform","translate(0,0)"),d3.selectAll(".efsa-pesticide-subtab-text-"+y).attr("transform","translate(0,0)");var v=null;v=m>-1&&4>y?d3.select("#efsa-pesticide-subtabs-group-"+y).selectAll(".efsa-pesticide-subtab-rect")._groups.length?d3.select("#efsa-pesticide-subtabs-group-"+y).selectAll(".efsa-pesticide-subtab-rect")._groups[0][m]:d3.selectAll(".efsa-pesticide-tab-title")._groups[0][m]:d3.selectAll(".efsa-pesticide-tab-title")._groups.length?d3.selectAll(".efsa-pesticide-tab-title")._groups[0][y]:d3.selectAll(".efsa-pesticide-tab-title")._groups[0][y],v&&(p?d3.selectAll(".efsa-pesticide-subtab").attr("fill",function(){return d3.select(this).attr("fill-brighter")}):d3.selectAll(".efsa-pesticide-subtab").transition().duration(h/5).attr("fill",function(){return d3.select(this).attr("fill-brighter")}),m>-1&&(p?d3.select(v).attr("fill",d3.select(v).attr("fill-default")):d3.select(v).transition().duration(h/5).attr("fill",d3.select(v).attr("fill-default")))),"food"===i?setTimeout(function(){u&&d3.selectAll(".efsa-pesticide-expanded-circle-rect-text").attr("x",0),sa(z.foods[c],s,d3.select(v),f)},u&&"food"===i?h:0):"country"===i&&setTimeout(function(){ca(c,s[0],s[1])},u?h:0),x(F),x(L),L.attr("cx",0).attr("cy",0),"food"===i?ga(o,l,d):L.attr("stroke-width",Ae/10).transition().duration(h).attr("r",Ae)}function da(t,a,r,i,n){var c="#e8e8e8";d3.selectAll(".efsa-pesticide-expanded-circle-pie").selectAll("*").remove();var s=he?0:h;he=!0,L.attr("stroke-width",Ae/10).transition().duration(s).attr("r",Ae).on("end",function(){var o=[c,c,c,c,"#3186d3","#dd6c31","#ac56c1","#33b53c"],l=[c,c,c,c,"#1166b3","#bd4c11","#8c36a1","#13951c"],d=[t,a,r,i],u=t+a+r+i,x=1/u*d[0],y=1/u*d[1],m=1/u*d[2],h=1/u*d[3],v=" "+(100/u*d[0]).toFixed(1).replace(".",Fe).replace(",",Fe)+"%",g=" "+(100/u*d[1]).toFixed(1).replace(".",Fe).replace(",",Fe)+"%",b=" "+(100/u*d[2]).toFixed(1).replace(".",Fe).replace(",",Fe)+"%",w=" "+(100/u*d[3]).toFixed(1).replace(".",Fe).replace(",",Fe)+"%",_=[z.composition_chart.domestic_samples+v,z.composition_chart.eea_countries+g,z.composition_chart.third_countries+b,z.composition_chart.unknown_origin+w],k=s;d=d.sort(function(t,e){return t>e?-1:e>t?1:0});var A=Ae-Ae/15;Ma(d3.select(".efsa-pesticide-expanded-circle-pie"),0,1,o[0],k,A+A/35-A/5,A,function(){}),Ma(d3.select(".efsa-pesticide-expanded-circle-pie"),0,1,o[1],k/2,A+A/35-A/5*2,A-A/5,function(){}),Ma(d3.select(".efsa-pesticide-expanded-circle-pie"),0,1,o[2],k/3,A+A/35-A/5*3,A-A/5*2,function(){}),Ma(d3.select(".efsa-pesticide-expanded-circle-pie"),0,1,o[3],k/4,A+A/35-A/5*4,A-A/5*3,function(){}),Ma(d3.select(".efsa-pesticide-expanded-circle-pie"),0,x,o[4],2*k,A+A/35-A/5,A,function(){}),Ma(d3.select(".efsa-pesticide-expanded-circle-pie"),0,y,o[5],1.5*k,A+A/35-A/5*2,A-A/5,function(){}),Ma(d3.select(".efsa-pesticide-expanded-circle-pie"),0,m,o[6],k,A+A/35-A/5*3,A-A/5*2,function(){}),Ma(d3.select(".efsa-pesticide-expanded-circle-pie"),0,h,o[7],k/1.5,A+A/35-A/5*4,A-A/5*3,function(){d3.select(".efsa-pesticide-expanded-circle-pie").selectAll("path").style("cursor","pointer").on("mousemove",function(t,e){d3.select(this).attr("fill")!==c&&pa(this,_,e-4,l[e])}).on("mouseout",function(t,e){ia(-1),fa(this,o[e])}).on("click",function(t,a){q.d3stopPropagation(),a>3&&(ia(-1),4==a?f("send","event",{eventCategory:"Pesticides origin chart",eventAction:"EEA",eventLabel:"EEA"}):5==a?f("send","event",{eventCategory:"Pesticides origin chart",eventAction:"Domestic",eventLabel:"Domestic"}):6==a?f("send","event",{eventCategory:"Pesticides origin chart",eventAction:"Third Countries",eventLabel:"Third Countries"}):7==a&&f("send","event",{eventCategory:"Pesticides origin chart",eventAction:"Unknown origin",eventLabel:"Unknown origin"}),xa(n,e,!1,!0,0,[Be[a-4]]))})});var T=p?70:80;d3.select(".efsa-pesticide-expanded-circle-pie").append("image").attr("xlink:href","/sites/default/files/interactive_tools/pesticidesresidues_2016/img/pie-chart-icon.png").style("cursor","pointer").attr("x",-T/2).attr("y",-T/2).attr("width",T).attr("height",T).on("mouseover",function(){d3.select(this).attr("xlink:href","/sites/default/files/interactive_tools/pesticidesresidues_2016/img/pie-chart-icon-over.png")}).on("mouseout",function(){d3.select(this).attr("xlink:href","/sites/default/files/interactive_tools/pesticidesresidues_2016/img/pie-chart-icon.png")}).on("click",function(){q.d3stopPropagation(),ia(-1),f("send","event",{eventCategory:"Pesticides origin chart",eventAction:"All",eventLabel:"All"}),xa(n,e,!1,!0,0,null)})})}function pa(t,e,a,r){d3.select(t).attr("opacity",1),d3.select(t).transition().duration(h/3).attr("fill",r),ra(+d3.event.x+2,+d3.event.y-60,e[a],r,-1)}function fa(t,e){d3.select(t).attr("opacity",1),d3.select(t).transition().duration(h/2).attr("fill",e)}function ua(t){var e=d3.select(".efsa-composition-chart-legend-item-"+t+"-text").classed("efsa-pesticide-composition-chart-filter-inactive");d3.select(".efsa-composition-chart-legend-item-"+t+"-text").classed("efsa-pesticide-composition-chart-filter-inactive",!e)}function xa(t,e,a,i,n,c){var s=i?h:0;(xe||ye)&&wa(),y(E),y(Q),y(I);var l=Be,d=[z.composition_chart.domestic_samples,z.composition_chart.eea_countries,z.composition_chart.third_countries,z.composition_chart.unknown_origin],f=[];if(c)f=c;else for(var u=0;4>u;u++){var m=d3.select(".efsa-composition-chart-legend-item-"+u+"-text");m.node()&&m.classed("efsa-pesticide-composition-chart-filter-inactive")||f.push(l[u])}U.empty(),U.html(""),U.node().innerHTML="",U.selectAll("*").remove(),U.style("opacity","1"),U.append("rect").attr("x",0).attr("y",0).attr("width",$).attr("height",te).attr("fill","#f4f4f4"),U.append("rect").attr("x",$-70).attr("y",0).attr("width",50).attr("height",50).attr("fill","#f4f4f4").on("click",function(){Na()}),U.append("text").style("pointer-events","auto").style("cursor","pointer").attr("x",$-45).attr("y",4.6*Oe).text("x").attr("font-size","36px").on("mouseover",function(){d3.select(this).style("text-decoration","underline")}).on("mouseout",function(){d3.select(this).style("text-decoration","none")}).on("click",function(){Na()});var v,g={Domestic:{normal:"#0b4e99",brighter:"#61a1db"},EU:{normal:"#dd6c31",brighter:"#e28e61"},TC:{normal:"#ac56c1",brighter:"#be7dcd"},UN:{normal:"#33b53c",brighter:"#63c46a"}};if(a){v=[];for(var b in r.composition){var w=r.composition[b];for(var _ in w)w[_].country===t&&v.push({country:b,type:w[_].type,samples:w[_].samples})}}else v=r.composition[t];var k=0;for(var A in v)k+=v[A].samples;v=v.filter(function(t){return f.indexOf(t.type)>-1});var T=0,C=0;for(var A in v)T=Math.max(T,v[A].samples),C+=v[A].samples;v=v.sort(function(t,e){return t=o(z.countries[t.country]),e=o(z.countries[e.country]),e>t?-1:t>e?1:0});var L=$/3.8,P=$/100,B=$/100,O=te/35,M=$/10,D=22;1111>$&&(D=10,O*=1.75);var F=6*O,W=d3.scaleLinear().domain([0,T]).range([0,L]),N=$-M-L-B;U.append("text").attr("x",$/2).attr("y",2*Oe).attr("text-anchor","middle").attr("fill","#202020").attr("font-size",Oe).attr("font-weight","400").text(z.composition_chart.title);for(var R=$/70,u=0;4>u;u++)!function(r){var i=f.indexOf(l[r])<0?" efsa-pesticide-composition-chart-filter-inactive ":"",n=$/6*(r+1)+R/2,c=g[l[r]].normal,s=n+R,o=3.5*Oe,u=o+$/70;if(1025>$&&(s+=2,u+=2),800>$&&(n-=3,o-=3),U.append("rect").attr("x",n).attr("width",s-n).attr("y",o).attr("height",u-o).attr("fill","transparent").style("cursor","pointer").on("click",function(){ua(r),setTimeout(function(){xa(t,e,a,!0,0,null)},50)}).on("mouseover",function(){d3.selectAll(".efsa-composition-chart-legend-item-"+r+"-close").attr("opacity",.5)}).on("mouseout",function(){d3.selectAll(".efsa-composition-chart-legend-item-"+r+"-close").attr("opacity",1)}),U.append("text").attr("class","efsa-composition-chart-legend-item efsa-composition-chart-legend-item-"+r+"-text efsa-composition-chart-legend-item-"+r+i).attr("x",n+R+5).attr("y",3.6*Oe+R-Me/2+(p?3:0)).attr("font-weight","400").attr("font-size",800>$?"10px":1025>$?"13px":"15px").attr("fill",c).text(d[r]),i){var x=2;n+=x,s-=x,o+=x,u-=x,_="M"+n+","+o+" L"+s+","+o+" L"+s+","+u+" L"+n+","+u+" Z"}else{var x=2;n+=x,s-=x,o+=x,u-=x;var y=n+(s-n)/2,m=o+(u-o)/2;_="M"+n+","+o+" L"+s+","+o+" L"+s+","+u+" L"+n+","+u+" Z M"+(y-3)+","+m+" L"+(y-1)+","+(m+3)+" L"+(y+4)+","+(m-3)}U.append("path").attr("class","efsa-composition-chart-legend-item efsa-composition-chart-legend-item-"+r+"-close efsa-composition-chart-legend-item-"+r).attr("d",_).attr("stroke",c).attr("fill","transparent").attr("stroke-width","2px").style("pointer-events","none")}(u);var S=F-2*O;U.append("rect").attr("x",P).attr("y",S).attr("width",$/2-P-1).attr("height",1.5*O).attr("fill","#dbdbdb"),U.append("rect").attr("x",$/2+1).attr("y",S).attr("width",$/2-B-1).attr("height",1.5*O).attr("fill","#dbdbdb"),U.append("text").attr("x",P+15).attr("y",S+1.5*Oe).attr("fill","#202020").style("font-size",Oe+"px").attr("font-weight","400").text(z.composition_chart.origin),U.append("text").attr("x",$-B-15).attr("y",S+1.5*Oe).attr("fill","#202020").text(z.composition_chart.analysing_countries).style("font-size",Oe+"px").attr("font-weight","400").attr("text-anchor","end"),x(U);for(var Z=v.length<n+D?v.length:n+D,H=M+L,u=n;Z>u;u++){var X=a?$-H-B:P,Y=a?X:P+M+L-W(v[u].samples),j=W(v[u].samples),J=(u-n)*(O+5)+F,V=O,G=a?$-B-5:X+5,K=a?"end":"start";!function(t,r){U.append("rect").attr("x",X).attr("width",H).attr("y",J).attr("height",O).attr("fill","#ffffff").style("cursor","pointer").on("click",function(){q.d3stopPropagation(),xa(r,e,a?!1:!0,!0,0,null)}).on("mouseover",function(){ha(this,"#composition-chart-text-origin-"+t)}).on("mouseout",function(){va(this,"#composition-chart-text-origin-"+t,"#ffffff","#202020")})}(u,v[u].country);var ee=z.countries[v[u].country];ee=ee?ee:v[u].country,U.append("text").attr("id","composition-chart-text-origin-"+u).attr("x",G).attr("y",J+1.5*Me).attr("text-anchor",K).attr("fill","#202020").attr("font-size",Me+"px").text(v[u].country===t?z.global.domestic+" ("+q.numberWithCommas(v[u].samples,We)+")":(ee.length>50?ee.substr(0,48)+"..":ee)+" ("+q.numberWithCommas(v[u].samples,We)+")"),U.append("rect").attr("x",Y).attr("width",j).attr("y",J).attr("height",V).style("pointer-events","none").attr("fill",g[v[u].type].normal).attr("opacity",0).transition().delay(i?20*u:0).duration(s).attr("opacity",1);var _=a?"M"+X+","+J+" L"+(M+L+P)+","+(V/2+F)+" L"+X+","+(J+V)+" Z":"M"+(Y+j)+","+J+" L"+N+","+(V/2+F)+" L"+(Y+j)+","+(J+V)+" Z";U.append("path").attr("d",_).attr("fill",g[v[u].type].brighter).attr("opacity",0).transition().delay(i?20*u:0).duration(s).attr("opacity",1)}n<v.length-D+1&&U.append("image").attr("xlink:href","/sites/default/files/interactive_tools/pesticidesresidues_2016/img/menu arrow down b.png").attr("x",a?$-H/1.5-25:H/1.5-25).attr("y",te-1.5*O).attr("height",O/1.3).attr("width",O/1.3).style("cursor","pointer").on("click",function(){q.d3stopPropagation(),xa(t,e,a,!1,n+1,null)}),n>0&&U.append("image").attr("xlink:href","/sites/default/files/interactive_tools/pesticidesresidues_2016/img/menu arrow up b.png").attr("x",a?$-H/1.5+25:H/1.5+25).attr("y",te-1.5*O).attr("height",O/1.3).attr("width",O/1.3).style("cursor","pointer").on("click",function(){q.d3stopPropagation(),xa(t,e,a,!1,n-1,null)}),U.on("mousewheel",null),U.on("wheel",null);var ae=v.length-D+1,re=Ue?"mousewheel":"wheel";!function(t,e,a,r,i){U.on(re,function(){var n=d3.event.wheelDelta||d3.event.deltaY;(Ee||De)&&(n=-n),0>n&&i>r&&xa(t,e,a,!1,r+1,null),n>0&&r>0&&xa(t,e,a,!1,r-1,null)
})}(t,e,a,n,ae),U.append("rect").attr("x",a?B:N).attr("width",M+L).attr("y",0+F).attr("height",O).attr("fill","#0b4e99"),U.append("text").attr("x",a?B+5:N+5).attr("y",0+1.3*Me+F).attr("fill","#ffffff").style("font-size",Me+"px").text(z.countries[t]?z.countries[t]+" ("+q.numberWithCommas(C,We)+")":t+" ("+q.numberWithCommas(C,We)+")"),U.append("image").attr("xlink:href","/sites/default/files/interactive_tools/pesticidesresidues_2016/img/menu arrow down.png").attr("x",a?M+L-O/2-10:N+M+L-O/2-10).attr("y",0+F+O/2-O/4).attr("height",O/2).attr("width",O/2).style("cursor","pointer").on("click",function(){q.d3stopPropagation(),x(d3.selectAll(".composition-chart-dropdown-analysing"))}),U.append("image").attr("xlink:href","/sites/default/files/interactive_tools/pesticidesresidues_2016/img/pie chart.png").attr("x",a?M+L-3*O/2-10:N+M+L-3*O/2-10).attr("y",0+F+O/2-O/4).attr("height",O/2).attr("width",O/2).style("cursor","pointer").on("click",function(){q.d3stopPropagation();var e=a?Re[t].value_below_loq:Ne[t].value_below_loq,r=a?Re[t].value_below_mrl:Ne[t].value_below_mrl,i=a?Re[t].value_above_mrl:Ne[t].value_above_mrl;ma(t,e,r,i,C,a,k)});var ie;if(a){ie=[];for(var ne in Re)ie.push(ne);ie=ie.sort(function(t,e){return t=o(z.countries[t]),e=o(z.countries[e]),t>e?1:e>t?-1:0})}else ie=e.countries.sort(function(t,e){return t=o(z.countries[t]),e=o(z.countries[e]),t>e?1:e>t?-1:0});var ce=0,se=te>800?32:20;ya(ce,se,ie,a,P,N,F,O,M,L,!1),U.append("rect").attr("id","composition-chart-cover").attr("x",0).attr("y",F-5).attr("width",$).attr("height",te-F).attr("fill","#ffffff").attr("opacity",.85).style("display","none")}function ya(t,a,r,i,n,c,s,o,l,d,p){U.selectAll(".composition-chart-dropdown-analysing").remove();for(var f=7,u=1.4*Me,x=Ue?"mousewheel":"wheel",y=0,m=t,h=r.length;a>m&&h>m;m++)!function(i,m,v){var g=0+s+(i-t+1)*u+o-Me;y=g,U.append("rect").attr("class","composition-chart-dropdown-analysing").style("display",p?"block":"none").attr("x",v?n:c).attr("y",g).attr("width",l+d).attr("height",u).attr("fill","#eaeaea").style("cursor","pointer").on("click",function(){q.d3stopPropagation(),xa(m,e,v?!0:!1,!0,0,null)}).on("mouseover",function(){ha(this,"#composition-chart-text-analysing-"+i)}).on("mouseout",function(){va(this,"#composition-chart-text-analysing-"+i,"#eaeaea","#202020")}).on(x,function(){q.d3stopPropagation();var e=d3.event.wheelDelta||d3.event.deltaY;(Ee||De)&&(e=-e),0>e?(h>a&&(t+=f,a+=f),ya(t,a,r,v,n,c,s,o,l,d,!0)):(t>f-1&&(t-=f,a-=f),ya(t,a,r,v,n,c,s,o,l,d,!0))});var b=z.countries[m];b=b?b:m,U.append("text").attr("class","composition-chart-dropdown-analysing").style("display",p?"block":"none").attr("id","composition-chart-text-analysing-"+i).attr("x",v?n+5:c+5).attr("y",g+Me).attr("fill","#202020").attr("font-size",Me+"px").style("cursor","pointer").text(b)}(m,r[m],i);t<r.length-(a-t)&&U.append("image").attr("class","composition-chart-dropdown-analysing").style("display",p?"block":"none").attr("xlink:href","/sites/default/files/interactive_tools/pesticidesresidues_2016/img/menu arrow down b.png").attr("x",i?50:$-80).attr("y",y+o).attr("height",o/1.7).attr("width",o/1.7).style("cursor","pointer").on("click",function(){q.d3stopPropagation(),t+=f,a+=f,ya(t,a,r,i,n,c,s,o,l,d,!0)}),t>0&&U.append("image").attr("class","composition-chart-dropdown-analysing").style("display",p?"block":"none").attr("xlink:href","/sites/default/files/interactive_tools/pesticidesresidues_2016/img/menu arrow up b.png").attr("x",i?80:$-50).attr("y",y+o).attr("height",o/1.7).attr("width",o/1.7).style("cursor","pointer").on("click",function(){q.d3stopPropagation(),t-=f,a-=f,ya(t,a,r,i,n,c,s,o,l,d,!0)})}function ma(t,e,a,r,i,n,c){q.d3stopPropagation(),d3.selectAll(".efsa-pesticide-expanded-circle-text").style("display","none"),ye=!0,x(d3.select("#composition-chart-cover")),x(L),x(F),y(H),y(Z),x(Q),x(I),L.attr("stroke-width",Ae/10).transition().duration(h).attr("r",Ae).on("end",function(){ga(e,a,r);var i=z.countries[t];i=i?i:t,d3.select("#efsa-pesticide-expanded-circle-rect-text-0").style("display","block").text(z.global.all_countries),d3.select("#efsa-pesticide-expanded-circle-rect-text-1").style("display","block").text(i+" | "+q.numberWithCommas(c,We)+" "+z.global.samples).attr("transform","translate("+-Ae/10+",0)"),d3.select("#efsa-pesticide-expanded-circle-rect-0").attr("x",0).attr("width",0).attr("transform","translate(0,0)").style("display","block").style("cursor","pointer"),d3.select("#efsa-pesticide-expanded-circle-rect-1").attr("x",0).attr("width",0).attr("transform","translate(0,0)").style("display","block").style("cursor","default"),d3.select("#efsa-pesticide-expanded-circle-rect-text-0").attr("x",0).attr("width",0).attr("transform","translate(0,0)").style("display","block"),d3.select("#efsa-pesticide-expanded-circle-rect-text-1").attr("x",0).attr("width",0).attr("transform","translate(0,0)").style("display","block");var s=d3.select("#efsa-pesticide-expanded-circle-rect-text-0")._groups[0][0].getBBox().width,o=d3.select("#efsa-pesticide-expanded-circle-rect-text-1")._groups[0][0].getBBox().width;if(n){var l=Ae+Ae/9+s,d=ne+ce+ce;d3.select("#efsa-pesticide-expanded-circle-rect-0").attr("transform","translate(0,"+d+")"),d3.select("#efsa-pesticide-expanded-circle-rect-0").transition().duration(h).attr("width",l).attr("transform","translate(0,"+d+")"),d3.select("#efsa-pesticide-expanded-circle-rect-text-0").attr("transform","translate(0,"+d+")"),d3.select("#efsa-pesticide-expanded-circle-rect-text-0").transition().duration(h).attr("transform","translate("+(l-s-15)+","+d+")");var p=Ae+Ae/9+o;d3.select("#efsa-pesticide-expanded-circle-rect-1").transition().duration(h).attr("width",p).attr("transform","translate("+-p+",0)"),d3.select("#efsa-pesticide-expanded-circle-rect-text-1").transition().duration(h).attr("transform","translate("+-(p-15)+",0)")}else{var l=Ae+Ae/9+s,d=ne+ce+ce;d3.select("#efsa-pesticide-expanded-circle-rect-0").attr("transform","translate(0,"+d+")"),d3.select("#efsa-pesticide-expanded-circle-rect-0").transition().duration(h).attr("width",l).attr("transform","translate("+-l+","+d+")"),d3.select("#efsa-pesticide-expanded-circle-rect-text-0").attr("transform","translate(0,"+d+")"),d3.select("#efsa-pesticide-expanded-circle-rect-text-0").transition().duration(h).attr("transform","translate("+-(l-15)+","+d+")");var p=Ae+Ae/9+o;d3.select("#efsa-pesticide-expanded-circle-rect-1").transition().duration(h).attr("width",p),d3.select("#efsa-pesticide-expanded-circle-rect-text-1").transition().duration(h).attr("transform","translate("+(p-o-15)+",0)")}F.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut").remove(),F.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut-text").remove(),setTimeout(function(){if(F.append("rect").attr("id","efsa-pesticide-expanded-circle-rect-close-composition-donut").attr("x",p+2).attr("y",-Ae+Ae/10+ne+5+(n?ce:0)).attr("width",ne).attr("height",ne).attr("fill","#a8a8a8").attr("cursor","pointer").on("click",function(){q.d3stopPropagation(),y(Q),y(I),I.selectAll("*").remove(),d3.select(this).remove(),ba()}).on("mouseover",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut-text").style("text-decoration","underline")}).on("mouseout",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut-text").style("text-decoration","none")}),F.append("text").attr("id","efsa-pesticide-expanded-circle-rect-close-composition-donut-text").attr("x",p+2+ne/2).attr("y",-Ae+Ae/10+ne+5+ne/2+Me/2.5+(n?ce:0)).attr("text-anchor","middle").attr("fill","white").style("font-size",1.25*Oe+"px").text("x"),n){var t=F.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut"),e=+t.attr("x"),a=+t.attr("width");t.attr("transform","translate("+-(2*e+a)+","+-ce+")");var t=F.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut-text"),e=+t.attr("x"),a=+t.attr("width");t.attr("transform","translate("+-(2*e+a)+","+-ce+")")}},h)})}function ha(t,e){d3.select(t).attr("fill","#3878b2"),d3.select(e).attr("fill","#ffffff")}function va(t,e,a,r){d3.select(t).attr("fill",a),d3.select(e).attr("fill",r)}function ga(t,e,a){var r=10;me||(r=10,d3.selectAll(".efsa-pesticide-expanded-circle-text").style("display","none").transition().duration(0).delay(function(t,e){return 2*h+30*e}).style("display","block"),me=!0),L.attr("stroke-width",Ae/10).transition().duration(h).attr("r",Ae).on("end",function(){var i=t,n=e,c=a,s=[i,n,c];i/=100,n/=100,c/=100;for(var o=d3.selectAll(".efsa-pesticide-expanded-circle-text-value"),l=0;3>l;l++){var d=d3.select(o._groups[0][l]),p=parseInt(d.text());isNaN(p)&&(p=0),oa(d,p,s[l],"%",1,r)}var f=h/2,u=Ae-Ae/10-Ae/20-Ae/10,x=Ae-Ae/10-Ae/20;Ma(I,0,i,v,f*i,u,x,function(){Ma(I,i,i+n,g,f*n,u,x,function(){Ma(I,i+n,i+n+c,b,f*c,u,x)})}),setTimeout(function(){for(var t=1;3>=t;t++){var e=d3.select("#efsa-pesticide-expanded-circle-text-"+t)._groups[0][0].getBBox().width;d3.select("#efsa-pesticide-expanded-circle-text-"+t+"c").attr("cx",-e/2-5)}},3*h)})}function ba(){we&&!le&&(Le||Ve(),d(),"food"===i&&de&&Ba(!0),Le&&(Le=!1),(xe||ye)&&wa(),p&&-1!==fe&&m(null,fe,!1),C.style("cursor","pointer"),F.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut").remove(),F.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut-text").remove(),F.select("#efsa-pesticide-expanded-circle-rect-close-food-name").remove(),F.select("#efsa-pesticide-expanded-circle-rect-close-food-name-text").remove(),y(d3.selectAll(".composition-chart-dropdown-analysing")),pe=-1,ye&&setTimeout(function(){y(d3.select("#composition-chart-cover"))},2*h))}function wa(){Ea(),Ke(),y(Q),y(I),y(Z),y(H),na(function(){Da(!0),d(),Ge(!0),xe=!1,ge=null,be=null,ye=!1,ue=!1,me=!1,he=!1})}function _a(){ue||("country"===i&&d3.selectAll(".country-code").each(function(t,e){d3.select(this).attr("x",d3.select("#efsa-pesticide-food-"+e).attr("cx")).attr("y",+d3.select("#efsa-pesticide-food-"+e).attr("cy")+Me/2)}),C.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("index",function(t){return t.index}))}function ka(t){for(var e,a,r=0,i=Ga,n=1*t;i>r;++r)e=Ja[r],a=ja[e.cluster],e.vx-=(e.x-a.x)*n,e.vy-=(e.y-a.y)*n}function qa(){if(!u&&G)for(var t=0;Ga>t;t++)Ja[t].fx=+G[t].cx,Ja[t].fy=+G[t].cy,Ja[t].x=+G[t].cx,Ja[t].y=+G[t].cy;E.attr("opacity",1),E.selectAll(".efsa-pesticide-food").attr("r",0).attr("opacity",1),u&&E.selectAll(".efsa-pesticide-food").attr("r",10);var e=d3.forceCollide().radius(function(t){return t.radius+1}).iterations(p||De?4:10),a=u?.015:.8;tr=d3.forceSimulation().nodes(Ja).force("center",d3.forceCenter()).force("collide",e).force("cluster",ka).force("gravity",d3.forceManyBody().strength(-20)).force("x",d3.forceX().strength(1)).force("y",d3.forceY().strength(1)).alphaDecay(a).on("tick",_a).on("end",function(){for(var t=0,e=Ga;e>t;t++){var a=Ja[t];Va.push({x:a.x,y:a.y,radius:a.radius})}var r=0,n="food"===i?2*h:3*h,c="food"===i?h/5:h/25;E.selectAll(".efsa-pesticide-food").transition().ease(q.qeaseElastic).duration(n).delay(function(t,e){return r++,200+e%20*c}).attr("r",function(){return d3.select(this).attr("r-val")}).on("end",function(){r--,0===r&&La()}),u&&(console.info("SAVING"),Pa()),"country"===i&&setTimeout(function(){for(var t=0;Ga>t;t++)Ja[t].fx=null,Ja[t].fy=null;tr.nodes(Ja).alphaTarget(.007).alphaDecay(.8).restart(),setTimeout(function(){Va=[];for(var t=0,e=Ga;e>t;t++){var a=Ja[t];Va.push({x:a.x,y:a.y,radius:a.radius})}},2e3)},100)})}function Aa(){C=E.selectAll(".efsa-pesticide-food").data(Ja).enter().append("circle").attr("id",function(t,e){return"efsa-pesticide-food-"+e}).attr("class","efsa-pesticide-food").attr("stroke-width",0).attr("r",function(t){return t.radius}).attr("r-val",function(t){return t.radius}).attr("data-category",function(t){return t.category}).attr("data-subcategory",function(t){return t.subcategory}).attr("data-food",function(t){return t.food}).attr("fill-val",function(t){return"food"===i?Qa(t.cluster):A}).attr("fill",function(t){return"food"===i?Qa(t.cluster):A}).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("cx-val",function(t){return t.x}).attr("cy-val",function(t){return t.y}).style("cursor","pointer"),"country"===i&&C.each(function(t,e){var a=d3.select(this);E.append("text").style("opacity","0").attr("class","country-code").attr("text-anchor","middle").attr("x",a.attr("cx")).attr("y",+a.attr("cy")).text(t.countrycode).attr("fill",T).attr("font-weight","700").attr("font-size",Me).transition().duration(500).delay(function(){return 1e3+30*e}).style("opacity","1")}),"country"===i&&C.attr("stroke",Ce).attr("stroke-width",ze);var t=[1,2,3,4];if(S.selectAll(".efsa-pesticide-expanded-circle-rect").data(t).enter().append("rect").attr("class","efsa-pesticide-expanded-circle-rect").attr("id",function(t,e){return"efsa-pesticide-expanded-circle-rect-"+e}).attr("y",function(t,e){return-Ae+Ae/10+e*(ne+5)}).attr("height","food"===i?ne:ne).style("display","none"),S.selectAll(".efsa-pesticide-expanded-circle-rect-text").data(t).enter().append("text").style("font-size",function(t,e){return(0===e?Oe:(Oe+Me)/2)+"px"}).attr("class","efsa-pesticide-expanded-circle-rect-text").attr("id",function(t,e){return"efsa-pesticide-expanded-circle-rect-text-"+e}).attr("y",function(t,e){var a=0===e?Oe:(Oe+Me)/2;return-Ae+Ae/10+e*(ne+5)+ne/2+a/2.5}),"food"===i&&S.append("image").attr("xlink:href","/sites/default/files/interactive_tools/pesticidesresidues_2016/img/sub-category.png").style("display","none").style("pointer-events","none").attr("height",.7*ne).attr("width",.7*ne).attr("x",Ae+Ae/10+2).attr("y",function(){return-Ae+Ae/10+2*(ne+5)+3}).attr("id","efsa-pesticide-expanded-circle-rect-icon-sub-category"),"country"===i&&(S.append("image").attr("xlink:href","/sites/default/files/interactive_tools/pesticidesresidues_2016/img/pie chart.png").style("display","none").style("pointer-events","none").attr("height",.7*ne).attr("width",.7*ne).attr("class","efsa-pesticide-expanded-circle-rect-icon").attr("id","efsa-pesticide-expanded-circle-rect-icon-pie-chart").attr("y",function(){var t=1;return-Ae+Ae/10+t*(ne+5)+.15*ne}).attr("x",Ae+Ae/9*1-ne),S.append("image").attr("xlink:href","/sites/default/files/interactive_tools/pesticidesresidues_2016/img/map marker.png").style("display","none").style("pointer-events","none").attr("height",.7*ne).attr("width",.7*ne).attr("class","efsa-pesticide-expanded-circle-rect-icon").attr("id","efsa-pesticide-expanded-circle-rect-icon-map-marker").attr("y",function(){var t=2;return-Ae+Ae/10+t*(ne+5)+.15*ne}).attr("x",Ae+Ae/9*2-ne)),L=S.append("circle").attr("r",0).attr("fill","white").attr("stroke-width",0).attr("pointer-events","none"),P=S.append("text").attr("class","efsa-pesticide-clicked-circle-text").style("font-size",Me+"px"),M=S.append("text").attr("class","efsa-pesticide-clicked-circle-text").style("font-weight","700").style("font-size",Oe+"px"),D=S.append("text").attr("class","efsa-pesticide-clicked-circle-text").style("font-weight","300").style("font-size",Me+"px"),"food"===i){B=S.append("rect").attr("rx",10).attr("ry",10).attr("width",94).attr("height",20).attr("pointer-events","none").style("display","none"),O=S.append("text").attr("fill","white").attr("font-size","10px").text(z.global.see_results).attr("pointer-events","none").attr("text-anchor","middle").style("font-weight","400").style("display","none");var e=0;De||Ee||Ue?e=5*O.text().length:(O.style("display","block"),e=O._groups[0][0].getBBox().width,O.style("display","none")),e>85&&O.attr("font-size","9px")}"food"===i?za():"country"===i&&(za(),y(Q),y(I),Ca(),y(Z),Ta())}function Ta(){var t=-Ae/2.2+3*Oe,e=-Ae/2.2+10*Oe;H.append("text").attr("class","efsa-pesticide-expanded-circle-text-for-country").attr("x",0).attr("y",-Ae/1.5).style("font-size",Oe+"px").text(""),H.append("text").attr("class","efsa-pesticide-expanded-circle-text-for-country").attr("x",0).attr("y",t).style("font-size",2*Oe+"px").text(""),H.append("text").attr("class","efsa-pesticide-expanded-circle-text-for-country").attr("x",0).attr("y",-Ae/2.2+5*Oe).style("font-size",Oe+"px").text(""),H.append("text").attr("class","efsa-pesticide-expanded-circle-text-for-country").attr("x",0).attr("y",e).style("font-size",2*Oe+"px").text(""),H.append("text").attr("class","efsa-pesticide-expanded-circle-text-for-country").attr("x",0).attr("y",-Ae/2.2+12*Oe).style("font-size",Oe+"px").text(""),H.append("text").attr("class","efsa-pesticide-expanded-circle-text-for-country").attr("x",0).attr("y",-Ae/2.2+13*Oe).style("font-size",Oe+"px").text(""),H.append("line").attr("class","efsa-pesticide-expanded-circle-line").attr("x1",-Ae/2).attr("y1",-Ae/2).attr("x2",+Ae/2).attr("y2",-Ae/2),H.append("line").attr("class","efsa-pesticide-expanded-circle-line").attr("x1",-Ae/2).attr("y1",(e+t)/2).attr("x2",+Ae/2).attr("y2",(e+t)/2)}function za(){var t=p?3:7;Q.append("text").attr("class","efsa-pesticide-expanded-circle-text").attr("id","efsa-pesticide-expanded-circle-text-1").attr("fill",v).attr("x",10).attr("y",-Ae/2.5).text(z.global.below_loq).style("font-size",1.1*Oe+"px"),Q.append("text").attr("class","efsa-pesticide-expanded-circle-text efsa-pesticide-expanded-circle-text-value").attr("fill",v).attr("x",10).attr("y",-Ae/2.5+30).text("0.00%").style("font-size",1.5*Oe+"px"),Q.append("text").attr("class","efsa-pesticide-expanded-circle-text").attr("id","efsa-pesticide-expanded-circle-text-2").attr("fill",g).attr("x",10).attr("y",0).text(z.global.between_loq_and_mrl).style("font-size",1.1*Oe+"px"),Q.append("text").attr("class","efsa-pesticide-expanded-circle-text efsa-pesticide-expanded-circle-text-value").attr("fill",g).attr("x",10).attr("y",30).text("0.00%").style("font-size",1.5*Oe+"px"),Q.append("text").attr("class","efsa-pesticide-expanded-circle-text").attr("id","efsa-pesticide-expanded-circle-text-3").attr("fill",b).attr("x",10).attr("y",Ae/2.5).text(z.global.above_mrl).style("font-size",1.1*Oe+"px"),Q.append("text").attr("class","efsa-pesticide-expanded-circle-text efsa-pesticide-expanded-circle-text-value").attr("fill",b).attr("x",10).attr("y",Ae/2.5+30).text("0.00%").style("font-size",1.5*Oe+"px"),Q.append("circle").attr("class","efsa-pesticide-expanded-circle-text").attr("id","efsa-pesticide-expanded-circle-text-1c").attr("cx",-Ae/2+50).attr("cy",-Ae/2.5-7).attr("r",t).attr("fill",v),Q.append("circle").attr("class","efsa-pesticide-expanded-circle-text").attr("id","efsa-pesticide-expanded-circle-text-2c").attr("cx",-Ae/2+5).attr("cy",-7).attr("r",t).attr("fill",g),Q.append("circle").attr("class","efsa-pesticide-expanded-circle-text").attr("id","efsa-pesticide-expanded-circle-text-3c").attr("cx",-Ae/2+50).attr("cy",Ae/2.5-7).attr("r",t).attr("fill",b);var e,a=p?4:5;if(De||Ee||Ue)for(var r=1;3>=r;r++)e=d3.select("#efsa-pesticide-expanded-circle-text-"+r).text().length,d3.select("#efsa-pesticide-expanded-circle-text-"+r+"c").attr("cx",-e*a);else for(var r=1;3>=r;r++)e=d3.select("#efsa-pesticide-expanded-circle-text-"+r)._groups[0][0].getBBox().width,d3.select("#efsa-pesticide-expanded-circle-text-"+r+"c").attr("cx",-e/2-5)}function Ca(){I.selectAll("*").remove(),Z.append("g").attr("class","efsa-pesticide-expanded-circle-pie")}function La(){u&&console.info("START"),W.selectAll(".efsa-pesticide-tab").transition().duration(h/2).delay(function(t,e){return e*(h/6)}).attr("transform","translate(0,0)"),we=!0,d3.select("#efsa-pesticide-loading").transition().duration(2*h).style("background-color","rgba(255,255,255,0)").on("end",function(){y(d3.select("#efsa-pesticide-loading"))}),Wa()}function Pa(){var t=[];E.selectAll("circle").each(function(){var e=d3.select(this).attr("index"),a=d3.select(this).attr("cx"),r=d3.select(this).attr("cy");t[e]={cx:a,cy:r}});var e={};e.width=$,e.height=te,e.data=t,d3.request("saveForced.php").header("X-Requested-With","XMLHttpRequest").header("Content-Type","application/x-www-form-urlencoded").post("type="+i+"&data="+JSON.stringify(e),function(){})}function Ba(t){if(le=!0,F.attr("transform","translate("+$/2+","+te/2+")"),de=!1,t){var e=0;E.selectAll(".efsa-pesticide-food").transition().duration(h).ease(q.qeaseElastic).delay(function(){e++;var t=$/5-+d3.select(this).attr("cx")/2;return 0>t&&(t=0),t}).attr("transform","translate(0,0)").on("end",function(){e--,e?le=!0:(le=!1,de=!1)})}else le=!1,E.attr("transform","translate("+$/2+","+te/2+")"),E.selectAll(".efsa-pesticide-food").attr("transform","translate(0,0)")}function Oa(t){if(!p){le=!0;var e=0;E.selectAll(".efsa-pesticide-food").transition().ease(q.qeaseElastic).duration(h).delay(function(){e++;var t=$/4+ +d3.select(this).attr("cx")/2;return 0>t&&(t=0),t}).attr("transform","translate(+"+$/5+", 0)").on("end",function(){e--,e?le=!0:(le=!1,de=!0,t())})}}function Ma(t,e,a,r,i,n,c,s){function o(t){return function(e){var a=d3.interpolate(e.endAngle,t);return function(t){return e.endAngle=a(t),d(e)}}}p&&(i=0);var l=2*q.pi,d=d3.arc().innerRadius(n).outerRadius(c).startAngle(e*l);t.append("path").datum({endAngle:e*l}).attr("fill",r).attr("d",d).transition().duration(i).ease(d3.easeLinear).attrTween("d",o(a*l)).on("end",s)}function Da(t){I.text(""),I.html(""),t?setTimeout(function(){y(F)},1.2*h):y(F),"food"===i?y(Q):"country"===i&&y(H),y(d3.selectAll(".efsa-pesticide-expanded-circle-rect")),y(d3.selectAll(".efsa-pesticide-expanded-circle-rect-text")),Ea()}function Ea(){d3.select("#efsa-pesticide-expanded-circle-rect-icon-sub-category").style("display","none"),y(d3.select("#efsa-pesticide-expanded-circle-rect-icon-pie-chart")),y(d3.select("#efsa-pesticide-expanded-circle-rect-icon-map-marker")),F.select("#efsa-pesticide-expanded-circle-rect-close-all").remove(),F.select("#efsa-pesticide-expanded-circle-rect-close-all-text").remove(),F.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart").remove(),F.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart-text").remove(),F.select("#efsa-pesticide-expanded-circle-rect-close-map-marker").remove(),F.select("#efsa-pesticide-expanded-circle-rect-close-map-marker-text").remove()}function Ua(t,e){pe=e;for(var a=0;Ga>a;a++)a!==e&&(Ja[a].fx=null,Ja[a].fy=null);Ja[e].radius=Va[e].radius+.3*Va[e].radius,d3.select("#efsa-pesticide-food-"+e).transition().duration(2*h).ease(q.qeaseElastic).attr("r",Ja[e].radius),tr.nodes(Ja).alphaTarget(.002).alphaDecay(.8).restart()}function Fa(t,e){pe=-1;for(var a=0;Ga>a;a++)a!==e&&(Ja[a].fx=null,Ja[a].fy=null);Ja[e].radius=Va[e].radius,d3.select("#efsa-pesticide-food-"+e).transition().duration(2*h).ease(q.qeaseElastic).attr("r",Ja[e].radius),tr.nodes(Ja).alphaTarget(p?.003:.001).alphaDecay(.8).restart()}function Wa(){d3.selectAll(".efsa-pesticide-tab").on("click",Je),p?(C.on("click",function(t,e){if(q.d3stopPropagation(),!le&&we){var a=+new Date;if(!(h>a-ve)){if(ve=a,(-1===fe||fe!==t.index)&&"food"===i)return void(-1===fe?X(t,e):(m(null,fe,!1),setTimeout(function(){X(t,e)},h)));if("food"===i){m(t,e,!1);var r=t.color,n=t.category,c=t.subcategory,s=+t.value_below_loq,o=+t.value_below_mrl,l=+t.value_above_mrl,d=t.food,p=+t.samples;la(r,n,c,d,p,s,o,l,V),setTimeout(function(){Oa(function(){})},h)}else"country"===i&&(m(t,e,!1),Se(),la(k,"countries",t.subcategory,t.food,[t.samples,t.inhabitants],50,20,30,V))}}}),d3.selectAll(".efsa-pesticide-subtab").on("click",function(t){le||(l(),x(L),Ra(t,d3.select(this).attr("fill")))}),d3.selectAll(".efsa-pesticide-tab-title").on("click",function(t){return q.d3stopPropagation(),t?(Je(t),void Sa(t,d3.select(this).attr("fill"))):void ba()})):(C.on("mouseover",function(t){if(!xe&&!(fe>-1||ue||le||!we)){var e="food"===i?d3.select(this).attr("fill-val"):"gray",a=+d3.select(this).attr("opacity");if(1===a){var r=t.food;r="food"===i?z.foods[r]:z.countries[r],ra(+d3.select(this).attr("cx")+$/2-t.radius/3,+d3.select(this).attr("cy")+te/2-t.radius/3,r,e,d3.select(this).attr("index"))}}}),C.on("mousemove",function(t,e){xe||fe>-1||ue||le||!we||pe>-1||Ua(t,e)}),C.on("mouseout",function(t,e){ia(d3.select(this).attr("index")),ue||le||!we||xe||(-1===fe?Fa(t,e):(m(t,e,!0),setTimeout(function(){Fa(t,e)},.7*h)))}),C.on("click",function(t,e){if(q.d3stopPropagation(),"country"===i&&Fa(t,e),ia(-999),!(xe||de||le)&&we){var a=+new Date;if(!(h>a-ve)){if(ve=a,-1===fe&&"food"===i)return void X(t,e);if("food"===i){m(t,e,!1);var r=t.color,n=t.category,c=t.subcategory,s=+t.value_below_loq,o=+t.value_below_mrl,l=+t.value_above_mrl,d=t.food,p=+t.samples;la(r,n,c,d,p,s,o,l,V),setTimeout(function(){Oa(function(){})},h)}else"country"===i&&(m(t,e,!1),Se(),la(k,"countries",t.subcategory,t.food,[t.samples,t.inhabitants],50,20,30,V))}}}),L.on("mouseout",function(){xe||ba()}),d3.selectAll(".efsa-pesticide-subtab").on("mouseover",l),d3.selectAll(".efsa-pesticide-subtab").on("mouseout",s),d3.selectAll(".efsa-pesticide-subtab").on("click",function(t){le||(x(L),Ra(t,d3.select(this).attr("fill")))}),d3.selectAll(".efsa-pesticide-tab-title").on("mouseover",function(e,a){e&&n(t[a])}),d3.selectAll(".efsa-pesticide-tab-title").on("mouseout",function(){le||de||C.style("cursor","pointer").transition().duration(h).attr("opacity",1)}),d3.selectAll(".efsa-pesticide-tab-title").on("click",function(t){return q.d3stopPropagation(),t?(Je(t),void Sa(t,d3.select(this).attr("fill"))):void ba()})),"country"===i&&d3.selectAll(".efsa-pesticide-expanded-circle-rect").on("click",function(t,e){if(q.d3stopPropagation(),ia(-1),0===e)ye&&Na();else if(1===e){if(!ye){F.select("#efsa-pesticide-expanded-circle-rect-close-map-marker").remove(),y(H),y(Z),x(Q),x(I),ga(Ne[ge].value_below_loq,Ne[ge].value_below_mrl,Ne[ge].value_above_mrl);var a;a=d3.select("#efsa-pesticide-expanded-circle-rect-1"),a.style("cursor","default"),a.transition().duration(h).attr("transform",function(){return"translate("+-a.attr("width")+",0)"}).on("end",function(){x(d3.select("#efsa-pesticide-expanded-circle-rect-0")),x(d3.select("#efsa-pesticide-expanded-circle-rect-text-0"))}),d3.select("#efsa-pesticide-expanded-circle-rect-text-1").transition().duration(h).attr("transform",function(){return"translate("+(-2*a.attr("width")+d3.select(this)._groups[0][0].getBBox().width+15+ne)+",0)"}),d3.select("#efsa-pesticide-expanded-circle-rect-icon-pie-chart").transition().duration(h).attr("transform",function(){return"translate("+(-2*a.attr("width")+d3.select("#efsa-pesticide-expanded-circle-rect-text-1")._groups[0][0].getBBox().width+15+ne)+",0)"}),a=d3.select("#efsa-pesticide-expanded-circle-rect-2"),a.style("cursor","pointer"),a.transition().duration(h).attr("transform","translate(0,0)"),d3.select("#efsa-pesticide-expanded-circle-rect-text-2").transition().duration(h).attr("transform","translate(0,0)"),d3.select("#efsa-pesticide-expanded-circle-rect-icon-map-marker").transition().duration(h).attr("transform","translate(0,0)").on("end",function(){F.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart").remove(),F.append("rect").attr("id","efsa-pesticide-expanded-circle-rect-close-pie-chart").attr("x",-d3.select("#efsa-pesticide-expanded-circle-rect-1").attr("width")-ne-2).attr("y",-Ae+Ae/10+ne+5).attr("width",ne).attr("height",ne).attr("fill","#a8a8a8").attr("cursor","pointer").on("click",function(){var t=d3.select("#efsa-pesticide-expanded-circle-rect-1");t.transition().duration(h).attr("transform","translate(0,0)"),t.style("cursor","pointer"),d3.select("#efsa-pesticide-expanded-circle-rect-text-1").transition().duration(h).attr("transform","translate(0,0)"),d3.select("#efsa-pesticide-expanded-circle-rect-icon-pie-chart").transition().duration(h).attr("transform","translate(0,0)"),I.selectAll("*").remove(),y(Q),y(I),x(H),F.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart").remove(),F.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart-text").remove()}).on("mouseover",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart-text").style("text-decoration","underline")}).on("mouseout",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart-text").style("text-decoration","none")}),F.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart-text").remove(),F.select("#efsa-pesticide-expanded-circle-rect-close-map-marker-text").remove(),F.append("text").attr("id","efsa-pesticide-expanded-circle-rect-close-pie-chart-text").attr("x",-d3.select("#efsa-pesticide-expanded-circle-rect-1").attr("width")-ne-2+ne/2).attr("y",-Ae+Ae/10+ne+5+ne/2+Me/2.5).attr("text-anchor","middle").attr("fill","white").style("font-size",1.25*Oe+"px").text("x")})}}else if(2===e&&!ye){F.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart").remove(),y(H),y(Q),y(I),x(Z);var i=r.composition[ge],n={Domestic:0,EU:0,TC:0,UN:0};for(var c in i)n[i[c].type]+=+i[c].samples;da(n.Domestic,n.EU,n.TC,n.UN,ge),setTimeout(function(){d3.select(".efsa-pesticide-expanded-circle-pie").append("rect").attr("x",-Ae/3).attr("width",Ae/1.5).attr("y",-Oe).attr("height",2*Oe).attr("id","efsa-pesticide-expanded-circle-pie-tooltip").attr("stroke","white").attr("display","none").attr("pointer-events","none"),d3.select(".efsa-pesticide-expanded-circle-pie").append("text").attr("text-anchor","middle").attr("y",Me/2).attr("font-size",Me).attr("id","efsa-pesticide-expanded-circle-pie-tooltip-text").attr("fill","white").attr("display","none")},3*h);var a;a=d3.select("#efsa-pesticide-expanded-circle-rect-2"),a.style("cursor","default"),a.transition().duration(h).attr("transform",function(){return"translate("+-a.attr("width")+",0)"}).on("end",function(){x(d3.select("#efsa-pesticide-expanded-circle-rect-0")),x(d3.select("#efsa-pesticide-expanded-circle-rect-text-0"))}),d3.select("#efsa-pesticide-expanded-circle-rect-text-2").transition().duration(h).attr("transform",function(){return"translate("+(-2*a.attr("width")+d3.select(this)._groups[0][0].getBBox().width+15+ne)+",0)"}),d3.select("#efsa-pesticide-expanded-circle-rect-icon-map-marker").transition().duration(h).attr("transform",function(){return"translate("+(-2*a.attr("width")+d3.select("#efsa-pesticide-expanded-circle-rect-text-2")._groups[0][0].getBBox().width+15+ne)+",0)"}),a=d3.select("#efsa-pesticide-expanded-circle-rect-1"),a.style("cursor","pointer"),a.transition().duration(h).attr("transform","translate(0,0)"),d3.select("#efsa-pesticide-expanded-circle-rect-text-1").transition().duration(h).attr("transform","translate(0,0)"),d3.select("#efsa-pesticide-expanded-circle-rect-icon-pie-chart").transition().duration(h).attr("transform","translate(0,0)").on("end",function(){F.select("#efsa-pesticide-expanded-circle-rect-close-map-marker").remove(),F.append("rect").attr("id","efsa-pesticide-expanded-circle-rect-close-map-marker").attr("x",-d3.select("#efsa-pesticide-expanded-circle-rect-2").attr("width")-ne-2).attr("y",-Ae+Ae/10+2*(ne+5)).attr("width",ne).attr("height",ne).attr("fill","#a8a8a8").attr("cursor","pointer").on("click",function(){var t=d3.select("#efsa-pesticide-expanded-circle-rect-2");t.transition().duration(h).attr("transform","translate(0,0)"),t.style("cursor","pointer"),d3.select("#efsa-pesticide-expanded-circle-rect-text-2").transition().duration(h).attr("transform","translate(0,0)"),d3.select("#efsa-pesticide-expanded-circle-rect-icon-map-marker").transition().duration(h).attr("transform","translate(0,0)"),I.selectAll("*").remove(),y(Z),x(H),F.select("#efsa-pesticide-expanded-circle-rect-close-map-marker").remove(),F.select("#efsa-pesticide-expanded-circle-rect-close-map-marker-text").remove()}).on("mouseover",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-map-marker-text").style("text-decoration","underline")}).on("mouseout",function(){d3.select("#efsa-pesticide-expanded-circle-rect-close-map-marker-text").style("text-decoration","none")}),F.select("#efsa-pesticide-expanded-circle-rect-close-map-marker-text").remove(),F.select("#efsa-pesticide-expanded-circle-rect-close-pie-chart-text").remove(),F.append("text").attr("id","efsa-pesticide-expanded-circle-rect-close-map-marker-text").attr("x",-d3.select("#efsa-pesticide-expanded-circle-rect-2").attr("width")-ne-2+ne/2).attr("y",-Ae+Ae/10+2*(ne+5)+ne/2+Me/2.5).attr("text-anchor","middle").attr("fill","white").style("font-size",1.25*Oe+"px").text("x")})}}),F.on("click",function(){q.d3stopPropagation()}),L.on("click",function(){q.d3stopPropagation()}),"food"===i&&d3.select("#efsa-pesticide-expanded-circle-rect-2").on("click",function(){if(be===j){var t=ge;wa(),m(null,fe,!1),setTimeout(function(){n(t)},3*h)}else{var t=ge;wa(),m(null,fe,!1),setTimeout(function(){l(t)},3*h)}ba()}),K.on("click",ba)}function Na(){I.selectAll("*").remove(),y(H),y(Z),y(Q),U.transition().duration(h).style("opacity","0").on("end",function(){U.selectAll("*").remove(),x(E),ba(),ye=!1
}),d3.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut").remove(),d3.select("#efsa-pesticide-expanded-circle-rect-close-composition-donut-text").remove()}function Ra(t,i){q.d3stopPropagation();var n=r["subcat-"+t],c=t,s="";for(var o in e)if(e[o].indexOf(c)>-1){s=o;break}var l=0,d=0,p=0,f=0;_.each(a,function(e){e.subcategory===t&&(l+=+e.value_below_loq_as_samples,d+=+e.value_below_mrl_as_samples,p+=+e.value_above_mrl_as_samples,f++)}),l=100/n*l,d=100/n*d,p=100/n*p,la(i,s,c,c,n,l,d,p,J)}function Sa(t,e){q.d3stopPropagation();var i=r["cat-"+t],n=t,c=0,s=0,o=0,l=0;_.each(a,function(e){e.category===t&&(c+=+e.value_below_loq_as_samples,s+=+e.value_below_mrl_as_samples,o+=+e.value_above_mrl_as_samples,l++)}),c=100/i*c,s=100/i*s,o=100/i*o,la(e,n,"",n,i,c,s,o,j)}var Ia=0;_.each(a,function(t){Ia=Math.max(Ia,t.value)}),qe="food"===i?90:110,Te="food"===i?6:1,c(),Ba(!1),_.each(t,function(t,e){w[t]=w[e]});var Qa=function(t){return w[t]},Za=10,Ha=50,Xa=1e3,Ya=3e4,ja=new Array(Te),Ja=[],Va=[],Ga=0;_.each(a,function(e,a){var r,n="food"===i?Ia:Ia;if("food"===i)r=Za+(Ha-Za)/n*e.value;else{var c=Xa+Ya/n*e.value;r=Math.sqrt(c/Math.PI)}var s=t.indexOf(e.category),o=0,l=0;G&&(o=G[a].x,l=G[a].y);var d={cluster:s,radius:r,inhabitants:+e.inhabitants,samples:+e.value,value:+e.value,value_below_loq:e.value_below_loq,value_below_mrl:e.value_below_mrl,value_above_mrl:e.value_above_mrl,countrycode:e.countrycode,food:e.name,subcategory:e.subcategory,category:e.category,color:"food"===i?w[s]:k,x:o,y:l};Ja.push(d),Ga++,(!ja[s]||r>ja[s].radius)&&(ja[s]=d)}),xe=!1,ge=null,be=null,de=!1,oe=null;var Ka=0,$a=-1;ta();var tr;u?(qa(),E.attr("opacity","1"),setTimeout(La,15e3)):d3.text("/sites/default/files/interactive_tools/pesticidesresidues_2016/data/"+i+"-nodes.dat",function(t,e){if(t)throw t;var a=JSON.parse(e);G=a.data,qa()})}function o(t){return""===t[0]?t=t.replace("","O"):""===t[0]&&(t=t.replace("","A")),""===t[1]?t=t.replace("","e"):""===t[1]&&(t=t.replace("","u")),t}function l(){var t=window.location.search;if(t&&(t=t.split("?"),t.length&&(t=t[1]))){t=t.split("&");for(var e in t){var a=t[e].split("=");if("lang"===a[0])return a[1]}}var r=window.location.href;for(var e in x){var i=x[e];if(r.indexOf("/"+i+"/")>0)return i}return null}function d(t,e,a){console.info(t,e,a)}var p=q.mobilecheck(),f=f?f:d,u=!1,x=["en","it","fr","de"],y=l(),m=y||t.lang||navigator.language&&navigator.language.split("-")[0]||"en";x.indexOf(m)<0&&(m="en"),window.efsaPesticideDatavizLang=m;var h=t.time||(p?200:320),v=t.donut.color_1||"#30807c",g=t.donut.color_2||"#4cbf85",b=t.donut.color_3||"#c34a2d",w=t.colors||["#00aac0","#7baa52","#f27f89","#e8b469","#8e3392","#98935c","#7a7c7f"],k=t.gray||"#a8a8a8",A="#00626d",T="white",z=i18n(m);q.fastclick();var C,L,P,B,O,M,D,E,U,F,W,N,R,S,I,Q,Z,H,X=q.speedtest(),Y=q.ceil(X/10),j=1,J=2,V=3,G=null,K=d3.select("#efsa-pesticide-dataviz-svg"),$=K.node().clientWidth||parseInt(window.getComputedStyle(K.node()).width),te=K.node().clientHeight||parseInt(window.getComputedStyle(K.node()).height);K.attr("viewBox","0 0 "+$+" "+te),K.selectAll("*").remove();var ee,ae=q.round($/18.776),re=0,ie=31,ne=q.round(te/ie),ce=p?1:2,se=q.round($/4.8),oe=null,le=!1,de=!1,pe=-1,fe=-1,ue=!1,xe=!1,ye=!1,me=!1,he=!1,ve=0,ge=-1,be=null,we=!1,_e=te/3.85-ne,ke=.15,qe=null,Ae=te/3.75;$>1500&&(Ae+=20);var Te=null,ze=.25,Ce="#a0a0a0",Le=!1,Pe=0,Be=["Domestic","EU","TC","UN"],Oe=Math.min(q.round(te/45),q.round($/70));6>Oe&&(Oe=6);var Me=q.round(.8*Oe);Oe>16.5&&(Oe=16.5),Me>13&&(Me=13);var De=navigator.userAgent.indexOf("Trident")>-1,Ee=navigator.userAgent.indexOf("Firefox")>-1,Ue=navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")<0,Fe=q.getDecimalSeparator(m),We="."===Fe?",":".",Ne=[],Re=[];window.doFoods=function(){i()},window.doCountries=function(){n()};var Se=[function(){},i,n];window.location.search.indexOf("do=foods")>-1?Se[1]():window.location.search.indexOf("do=countries")>-1?Se[2]():Se[1]()}var efsaPesticideDatavizConfig={colors:["#00aac0","#7baa52","#f27f89","#e8b469","#8e3392","#98935c","#7a7c7f"],donut:{color_1:"#30807c",color_2:"#4cbf85",color_3:"#c34a2d"},gray:"#a8a8a8"};efsaPesticideDataviz(efsaPesticideDatavizConfig),window.addEventListener("resize",function(){efsaPesticideDataviz(efsaPesticideDatavizConfig)});